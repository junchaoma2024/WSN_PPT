% 附录A PDDL语言参考手册
\chapter{PDDL语言参考手册}
\label{app:pddl}

本附录提供PDDL（Planning Domain Definition Language）的语法参考。

\section{PDDL基本结构}

\subsection{领域文件结构}

\begin{lstlisting}[language=PDDL]
(define (domain <domain-name>)
  (:requirements <requirement-flags>)
  (:types <type-definitions>)
  (:constants <constant-definitions>)
  (:predicates <predicate-definitions>)
  (:functions <function-definitions>)
  (:action <action-definition>)*
)
\end{lstlisting}

\subsection{问题文件结构}

\begin{lstlisting}[language=PDDL]
(define (problem <problem-name>)
  (:domain <domain-name>)
  (:objects <object-definitions>)
  (:init <initial-state>)
  (:goal <goal-specification>)
  (:metric <metric-specification>)
)
\end{lstlisting}

\section{需求标志}

常用需求标志：
\begin{itemize}
    \item \texttt{:strips} -- 基本STRIPS功能
    \item \texttt{:typing} -- 类型系统
    \item \texttt{:negative-preconditions} -- 负前提条件
    \item \texttt{:disjunctive-preconditions} -- 析取前提条件
    \item \texttt{:equality} -- 等式判断
    \item \texttt{:existential-preconditions} -- 存在量词
    \item \texttt{:universal-preconditions} -- 全称量词
    \item \texttt{:conditional-effects} -- 条件效果
    \item \texttt{:numeric-fluents} -- 数值变量
    \item \texttt{:durative-actions} -- 持续性动作
    \item \texttt{:duration-inequalities} -- 持续时间不等式
    \item \texttt{:continuous-effects} -- 连续效果
\end{itemize}

\section{类型定义}

\begin{lstlisting}[language=PDDL]
(:types
  location city - object
  truck airplane - vehicle
  package - object
)
\end{lstlisting}

\section{谓词定义}

\begin{lstlisting}[language=PDDL]
(:predicates
  (at ?obj - object ?loc - location)
  (in ?pkg - package ?veh - vehicle)
  (connected ?from ?to - location)
)
\end{lstlisting}

\section{函数定义}

\begin{lstlisting}[language=PDDL]
(:functions
  (distance ?from ?to - location)
  (fuel ?v - vehicle)
  (total-cost)
)
\end{lstlisting}

\section{动作定义}

\subsection{基本动作}

\begin{lstlisting}[language=PDDL]
(:action drive
  :parameters (?t - truck ?from ?to - location)
  :precondition (and
    (at ?t ?from)
    (connected ?from ?to)
  )
  :effect (and
    (not (at ?t ?from))
    (at ?t ?to)
    (increase (total-cost) (distance ?from ?to))
  )
)
\end{lstlisting}

\subsection{持续性动作（PDDL 2.1）}

\begin{lstlisting}[language=PDDL]
(:durative-action fly
  :parameters (?a - airplane ?from ?to - city)
  :duration (= ?duration (/ (distance ?from ?to) (speed ?a)))
  :condition (and
    (at start (at ?a ?from))
    (at start (>= (fuel ?a) (fuel-required ?from ?to)))
    (over all (available ?to))
  )
  :effect (and
    (at start (not (at ?a ?from)))
    (at end (at ?a ?to))
    (at start (decrease (fuel ?a) (fuel-required ?from ?to)))
  )
)
\end{lstlisting}

\section{目标规范}

\subsection{简单目标}

\begin{lstlisting}[language=PDDL]
(:goal (and
  (at pkg1 loc-b)
  (at pkg2 loc-c)
))
\end{lstlisting}

\subsection{带偏好的目标（PDDL 3.0）}

\begin{lstlisting}[language=PDDL]
(:goal (and
  (at pkg1 loc-b)
  (preference p1 (at pkg2 loc-c))
))

(:metric minimize (+ (total-cost) (* 100 (is-violated p1))))
\end{lstlisting}

\section{度量规范}

\begin{lstlisting}[language=PDDL]
(:metric minimize (total-cost))
(:metric maximize (packages-delivered))
(:metric minimize (total-time))
\end{lstlisting}

\section{完整示例}

\subsection{物流领域}

\begin{lstlisting}[language=PDDL]
(define (domain logistics)
  (:requirements :strips :typing)

  (:types
    city location thing - object
    package vehicle - thing
    truck airplane - vehicle
    airport - location
  )

  (:predicates
    (in-city ?loc - location ?city - city)
    (at ?obj - thing ?loc - location)
    (in ?pkg - package ?veh - vehicle)
  )

  (:action load-truck
    :parameters (?pkg - package ?truck - truck ?loc - location)
    :precondition (and (at ?truck ?loc) (at ?pkg ?loc))
    :effect (and (not (at ?pkg ?loc)) (in ?pkg ?truck))
  )

  (:action unload-truck
    :parameters (?pkg - package ?truck - truck ?loc - location)
    :precondition (and (at ?truck ?loc) (in ?pkg ?truck))
    :effect (and (not (in ?pkg ?truck)) (at ?pkg ?loc))
  )

  (:action drive-truck
    :parameters (?truck - truck ?from ?to - location ?city - city)
    :precondition (and
      (at ?truck ?from)
      (in-city ?from ?city)
      (in-city ?to ?city)
    )
    :effect (and (not (at ?truck ?from)) (at ?truck ?to))
  )

  (:action load-airplane
    :parameters (?pkg - package ?airplane - airplane ?loc - airport)
    :precondition (and (at ?pkg ?loc) (at ?airplane ?loc))
    :effect (and (not (at ?pkg ?loc)) (in ?pkg ?airplane))
  )

  (:action unload-airplane
    :parameters (?pkg - package ?airplane - airplane ?loc - airport)
    :precondition (and (in ?pkg ?airplane) (at ?airplane ?loc))
    :effect (and (not (in ?pkg ?airplane)) (at ?pkg ?loc))
  )

  (:action fly-airplane
    :parameters (?airplane - airplane ?from ?to - airport)
    :precondition (at ?airplane ?from)
    :effect (and (not (at ?airplane ?from)) (at ?airplane ?to))
  )
)
\end{lstlisting}
