# 第二章 2.2 物理层技术介绍 - 备课笔记（逐字稿版）

## 课程信息
- **课程名称**：传感器网络技术与应用
- **章节**：第2章 2.2 物理层技术介绍
- **课时**：6课时（300分钟）
- **学生背景**：已学习2.1节OSI模型，尚未系统学习通信原理

---

# 第1课时：2.2.1 物理层概述与设计要求（50分钟）

## 【开场白】（2分钟）

同学们好！上节课我们学习了OSI七层模型，大家还记得最底层是哪一层吗？对，是物理层。今天开始，我们用6节课的时间来深入学习物理层的相关技术。

物理层虽然是最底层，但它是整个网络通信的基础。打个比方，如果把网络通信比作寄快递，那物理层就是那条实际的道路——没有路，快递车根本开不了。

## 【课程引入】（3分钟）

我先问大家一个问题：你们平时用手机上网，信号是怎么传到基站的？

没错，是通过无线电波。但是，我们的数据是0和1组成的数字信号，怎么变成无线电波发送出去的呢？发送出去之后，对方又是怎么正确接收的呢？

这些问题的答案，就藏在物理层技术里面。今天我们先来了解物理层的基本概念和设计要求。

---

## 【第一部分：物理层定义与功能】（15分钟）

### 1.1 什么是物理层？

根据ISO的定义，物理层为数据链路实体之间的比特流传输提供物理连接。

这个定义有点抽象，我来解释一下：
- 首先，物理层是协议栈的最底层，它直接和传输介质打交道——可能是网线，也可能是无线电波
- 其次，物理层传输的是"比特流"，就是一连串的0和1
- 最后，物理层要建立"物理连接"，也就是让数据能够从一个设备传到另一个设备

简单来说，**物理层就是负责把比特从A点搬运到B点的"搬运工"**。

### 1.2 物理层的主要功能

物理层要完成哪些工作呢？主要有六个方面：

**第一，传输数据。** 这是最核心的功能，为上层提供一条透明的数据传输通路。所谓"透明"，就是说上层不需要关心物理层具体是怎么传输的，只管把数据交给物理层就行。

**第二，选择传输介质。** 是用有线还是无线？用什么类型的线缆？用什么频段的无线电波？这些都是物理层要考虑的。

**第三，频段分配。** 特别是无线通信，要选择合适的工作频段。不同频段有不同的特点，后面我们会详细讲。

**第四，信号编码。** 包括信源编码和信道编码。信源编码是为了压缩数据，信道编码是为了提高可靠性。

**第五，数据调制。** 把我们的数字信号"搬"到高频载波上，这样才能通过天线发射出去。

**第六，收发管理。** 评估信道状态，检测能量，决定什么时候发送、什么时候接收。

大家先有个印象，这六个功能我们后面几节课会逐个深入学习。

---

## 【第二部分：物理层特性】（15分钟）

### 2.1 五大特性

物理层有五个方面的特性规定，我们用一张表来看：

| 特性 | 说明 | 举例 |
|------|------|------|
| 机械特性 | 接口的物理形状、尺寸、引脚数量 | USB接口的形状 |
| 电气特性 | 电压范围、阻抗、信号电平 | 高电平是多少伏 |
| 功能特性 | 各信号线的用途 | 哪根是数据线、哪根是地线 |
| 规程特性 | 传输事件的顺序 | 先发什么、后发什么 |
| 链路特性 | 无线信道的传播特性 | 信号衰减、干扰等 |

前四个特性主要是针对有线连接的，比如网线接口、USB接口。第五个链路特性是我们无线传感器网络特别要关注的。

### 2.2 无线链路特性（重点）

无线信道和有线信道有很大不同。有线传输相对稳定，而无线传输要面临很多挑战：

**第一个挑战：路径损耗。**

大家都有经验，离路由器越远，WiFi信号越弱。这就是路径损耗——信号能量随着传播距离增大而衰减。

衰减有多快呢？在理想情况下，接收功率和距离的平方成反比。也就是说，距离翻一倍，信号强度降到原来的四分之一。在实际环境中，衰减可能更严重，和距离的3次方甚至4次方成反比。

**第二个挑战：多径效应。**

无线信号从发送端到接收端，不一定只走一条路。它可能直接到达，也可能从墙壁反射过来，还可能从地面反射过来。这样，接收端会收到多个"副本"，这些副本会叠加在一起。

问题是，这些副本走的路程不一样长，到达的时间不一样，相位也不一样。如果恰好同相，信号会增强；如果反相，信号可能会相互抵消！这就是为什么有时候你站在某个位置信号很好，换个位置就很差。

**第三个挑战：噪声干扰。**

噪声无处不在。人为噪声来自各种电气设备，自然噪声来自雷电、太阳活动，还有设备内部的热噪声。噪声会和有用信号混在一起，影响接收质量。

**第四个挑战：邻节点干扰。**

无线传感器网络的节点往往部署得很密集，可能有几十个、几百个节点在同一个区域。如果它们都用同一个频段，就会相互干扰。这需要MAC层协议来协调，但物理层也要考虑这个问题。

**第五个挑战：链路非对称性。**

A能听到B，不代表B也能听到A。这在无线网络中很常见，因为两个方向的传播条件可能不同。

这五个挑战，就是无线传感器网络物理层设计必须考虑的因素。

---

## 【第三部分：WSN物理层设计要求】（10分钟）

了解了无线信道的挑战，我们来看看无线传感器网络对物理层有什么特殊要求。

### 3.1 设计目标

一句话概括：**以尽可能少的能量消耗，获得较大的链路容量。**

为什么强调"少的能量消耗"？因为传感器节点通常用电池供电，没法经常换电池，必须省电。

### 3.2 具体要求

**第一，低功耗。** 这是最重要的要求。传感器节点可能要工作几个月甚至几年，全靠一块小电池。

**第二，低发射功率。** 传感器网络通常是短距离通信，不需要很大的发射功率。功率低了，电池就更耐用。

**第三，低占空比。** 什么意思呢？就是大部分时间处于休眠状态，只在需要的时候才唤醒工作。比如，每分钟只工作1秒钟，占空比就是1/60。

**第四，相对低的数据率。** 传感器数据通常不大，温度、湿度这些数值，几十个比特就够了。不需要像视频传输那样的高速率，几十到几百kbps就足够了。

**第五，低实现复杂度。** 芯片设计要简单，这样才能降低成本、降低功耗。

**第六，低成本。** 传感器网络可能要部署成千上万个节点，如果每个节点太贵，整体成本就无法接受。

### 3.3 设计挑战

这些要求有时候是矛盾的。比如：
- 想要传得远，就需要大功率，但大功率就费电
- 想要可靠，就需要复杂的编码，但复杂就意味着高成本
- 使用免费的ISM频段，但这些频段干扰也多

如何在这些矛盾中找到平衡点，就是物理层设计的挑战。

---

## 【本课时小结】（5分钟）

好，我们来总结一下今天学习的内容：

1. **物理层是协议栈的最底层**，负责比特流的传输，是网络通信的基础设施

2. **物理层有六大功能**：传输数据、选择介质、频段分配、信号编码、数据调制、收发管理

3. **物理层有五大特性**：机械、电气、功能、规程、链路特性。对于无线网络，链路特性最重要

4. **无线链路面临五大挑战**：路径损耗、多径效应、噪声干扰、邻节点干扰、链路非对称性

5. **WSN物理层设计核心原则**：低功耗、低成本、低复杂度

下节课，我们将学习无线电波是如何传播的，以及如何选择合适的工作频段。请大家预习ISM频段的相关内容。

---

# 第2课时：2.2.2 无线电波与无线信道（50分钟）

## 【课前回顾】（5分钟）

同学们好！上节课我们学习了物理层的基本概念和设计要求。

我来问几个问题检验一下：
- 物理层有几大功能？（六大功能）
- 无线链路面临哪些挑战？（路径损耗、多径效应、噪声、邻节点干扰、链路非对称）
- WSN物理层设计的核心原则是什么？（低功耗、低成本、低复杂度）

很好！今天我们深入学习无线电波的传播特性和无线信道模型。

---

## 【课程引入】（3分钟）

我问大家一个问题：你们用过对讲机吗？或者玩过无线遥控车？

这些设备都是通过无线电波通信的。但是，你有没有发现，有时候明明距离很近，信号却很差？有时候隔着一堵墙就收不到了？

这就涉及到无线电波的传播特性。理解这些特性，才能设计好的无线通信系统。

---

## 【第一部分：传输介质与无线电波】（10分钟）

### 1.1 传输介质分类

物理层的传输介质分为两大类：

**有线传输介质：**
- 双绞线：最常见的网线
- 同轴电缆：有线电视用的线
- 光纤：速度最快，但成本高

**无线传输介质：**
- 声波：主要用于水下通信，因为电磁波在水中衰减太快
- 电磁波：包括无线电波、红外线、可见光

无线传感器网络主要使用**无线电波**，为什么呢？

第一，无线电波容易产生和传播，技术成熟
第二，可以穿透建筑物，不需要视距通信
第三，可以全方向传播，不需要精确对准收发天线

### 1.2 无线电波的传播方式

无线电波从发射天线出去后，可能经历四种传播方式：

**直射（Line of Sight）**：在自由空间中直线传播，这是最理想的情况。

**反射（Reflection）**：遇到比波长大得多的物体时，会像光一样被反射回来。比如建筑物的外墙、地面。

**散射（Scattering）**：遇到尺寸和波长差不多的物体，或者粗糙表面时，信号会向各个方向散开。比如树叶、路灯杆。

**绕射（Diffraction）**：遇到物体边缘时，波会绕过去继续传播。这就是为什么在山后面有时候也能收到信号。

在实际环境中，这四种传播方式通常同时存在，使得无线信道变得非常复杂。

---

## 【第二部分：无线信道模型】（17分钟）

### 2.1 自由空间信道

最简单的模型是自由空间信道——假设发射天线和接收天线之间没有任何障碍物，没有反射，没有散射。

在这种理想情况下，有一个著名的公式叫**Friis公式**：

接收功率和发射功率的比值，等于天线增益乘以一个和距离相关的因子。

这个公式的核心结论是：**接收功率和距离的平方成反比**。

打个比方，就像手电筒的光，距离越远，照射面积越大，单位面积的亮度就越低。距离翻倍，亮度变成原来的四分之一。

### 2.2 多径信道（重点）

自由空间模型太理想了。实际环境中，信号会被反射、散射，形成多条传播路径。

想象一下：你在房间里对着朋友说话，声音不仅直接传过去，还会从墙壁反射过来。如果房间很空旷，可能会有回声。无线电波也是一样的道理。

多径传播会带来两个问题：

**第一，多径衰落。** 多条路径的信号叠加，可能相互增强，也可能相互抵消。这取决于它们到达时的相位差。如果刚好反相（相差180度），信号可能几乎完全抵消！这就是为什么你有时候站在某个位置信号满格，挪动几十厘米就掉格。

**第二，时延扩展。** 不同路径的长度不同，信号到达的时间也不同。发送一个窄脉冲，接收端可能收到一串展宽的脉冲。这会导致码间干扰，影响数据传输速率。

对于无线传感器网络来说，多径效应意味着：
- 数据包可能损坏或丢失
- 需要采用适当的编码和调制技术来对抗

### 2.3 加性噪声信道

除了多径，还有噪声。噪声来源于：

- **人为噪声**：电机、汽车点火系统、电力线等
- **自然噪声**：雷电、太阳活动等
- **内部噪声**：设备内部电子元件产生的热噪声

其中，热噪声是无法消除的，它存在于任何有温度的物体中。

衡量信号质量的一个重要指标是**信噪比（SNR）**，就是信号功率和噪声功率的比值。信噪比越高，通信质量越好。

### 2.4 实际环境信道

实际的无线信道是上述几种模型的综合：
- 有路径损耗（距离越远信号越弱）
- 有多径效应（信号忽强忽弱）
- 有噪声干扰（信号不清晰）

工程上，我们用一个简化的模型来描述：接收功率和距离的n次方成反比，这个n叫做**路径损耗指数**。

在自由空间，n=2。在城市环境，n可能是3到4。在室内，n可能更大。对于无线传感器网络，由于节点通常部署在离地面很近的地方，路径损耗可能更严重。

---

## 【第三部分：频段选择与ISM频段】（15分钟）

### 3.1 频段选择的考量

无线通信要选择工作频段。不同频段各有利弊：

**低频率的特点：**
- 传播损耗小，信号能传得远
- 绕射能力强，能绕过障碍物
- 但是，频谱资源紧张，可用带宽小

**高频率的特点：**
- 频谱资源丰富，可用带宽大
- 天线尺寸小（天线长度约为波长的四分之一）
- 但是，传播损耗大，容易被障碍物阻挡

选择频段时要综合考虑：覆盖范围、传输速率、设备成本、功耗等因素。

### 3.2 ISM频段（重点）

ISM是Industrial, Scientific and Medical的缩写，意思是"工业、科学和医疗"频段。

这些频段的特点是：**免许可证，免费使用**。

但有代价：对发射功率有限制，而且要容忍其他设备的干扰。

无线传感器网络常用的ISM频段有三个：

| 频段 | 波长 | 特点 | 典型应用 |
|------|------|------|----------|
| 433MHz | 约70cm | 穿透力最强，传得远 | 远程遥控、LoRa |
| 868/915MHz | 约33cm | 平衡性好 | LoRa |
| 2.4GHz | 约12.5cm | 全球通用，带宽大 | WiFi、蓝牙、ZigBee |

### 3.3 2.4GHz频段的干扰问题

2.4GHz是最常用的ISM频段，但也是干扰最严重的。

你身边有多少设备在用2.4GHz？WiFi路由器、蓝牙耳机、无线鼠标、甚至微波炉（微波炉也工作在2.4GHz附近）！

当这些设备同时工作时，就会相互干扰。无线传感器网络在这个频段工作，必须具备抗干扰能力。这就引出了我们后面要学的扩频技术。

---

## 【本课时小结】（5分钟）

今天我们学习了无线电波的传播特性和信道模型：

1. **无线电波有四种传播方式**：直射、反射、散射、绕射

2. **无线信道模型**：
   - 自由空间信道：信号强度和距离平方成反比
   - 多径信道：导致信号衰落和时延扩展
   - 加性噪声信道：热噪声不可避免

3. **ISM频段是WSN首选**：免费使用，但要注意干扰问题

4. **常用ISM频段**：433MHz、868/915MHz、2.4GHz

下节课我们开始学习信源编码，重点是霍夫曼编码。这是一个很实用的技术，请大家预习。

---

# 第3课时：2.2.3 信源编码（50分钟）

## 【课前回顾与引入】（5分钟）

同学们好！前两节课我们学习了物理层的概述和无线信道特性。

我们知道，无线传感器网络要尽量省电。省电的一个重要方法是什么？**减少传输的数据量**。因为发送无线信号是很耗电的。

那么问题来了：如何减少数据量呢？

这就是今天要学的**信源编码**。

我先问大家一个问题：假设你要发送一段英文文字，每个字母都用8位二进制编码。有没有更省空间的方法？

想一想，字母E在英文中出现的频率最高，而Z出现得很少。如果对E用短编码，对Z用长编码，平均下来是不是能省空间？

这就是信源编码的基本思想。

---

## 【第一部分：信源编码概念】（10分钟）

### 1.1 定义与目的

**信源编码的目的**：减少或消除信源的冗余度，压缩数据量。

什么是冗余？就是"多余的信息"。比如：
- 在自然语言中，某些字母出现频率高，某些低——这是统计冗余
- 相邻的数据往往相似，比如连续两帧图像——这是时间冗余
- 相邻的像素颜色往往相近——这是空间冗余

信源编码就是要去掉这些冗余，用更少的比特表示相同的信息。

**信源编码的效果**：提高信道传输的有效性。用更少的比特传输相同的信息，等于提高了传输效率。

### 1.2 编码类型

信源编码分为两类：

**无损编码**：编码后可以完全恢复原始数据，一个比特都不差。缺点是压缩率有限。例如：ZIP压缩、霍夫曼编码。

**有损编码**：允许一定程度的信息损失，但可以获得更高的压缩率。例如：JPEG图像压缩、MP3音频压缩。

对于传感器网络，我们通常使用**无损编码**，因为传感器数据需要精确。温度读数如果有误差，可能影响后续决策。

### 1.3 常用无损编码方法

- **霍夫曼编码（Huffman Encoding）**：今天重点学习
- 香农-范诺编码
- 算术编码
- LZW编码（用于GIF图像）

接下来，我们重点学习霍夫曼编码。

---

## 【第二部分：霍夫曼编码详解】（25分钟）

### 2.1 基本思想

霍夫曼编码的思想非常直观：

- **出现频率高的符号，用短码表示**
- **出现频率低的符号，用长码表示**

这样，平均码长最短。

就像我们发短信用缩写一样：经常说的"谢谢"可以简写成"3Q"或"thx"，不常用的词就老老实实写全称。

### 2.2 霍夫曼编码五步流程（核心内容）

请大家记住这五个步骤：

**第一步：统计概率**
统计信源中各符号出现的概率（或频率）。

**第二步：排序**
将符号按概率从大到小排列。

**第三步：构造霍夫曼树**
- 选取概率最小的两个节点，合并成一个新节点
- 新节点的概率等于两个子节点概率之和
- 重复这个过程，直到只剩一个根节点

**第四步：分配码字**
从根节点开始，往左走标0，往右走标1（或者反过来也行，保持一致就行）。

**第五步：生成编码**
从根节点到每个叶子节点（原始符号）的路径，就是该符号的编码。

### 2.3 完整例题演示

我们来做一个完整的例子。

**题目**：信源有7个符号A、B、C、D、E、F、G，出现概率分别是0.1、0.18、0.47、0.05、0.06、0.1、0.04。请用霍夫曼编码。

**第一步：统计概率**（已给出）

| 符号 | A | B | C | D | E | F | G |
|------|---|---|---|---|---|---|---|
| 概率 | 0.10 | 0.18 | 0.47 | 0.05 | 0.06 | 0.10 | 0.04 |

**第二步：排序**

按概率从大到小：C(0.47) > B(0.18) > A(0.10) = F(0.10) > E(0.06) > D(0.05) > G(0.04)

**第三步：构造霍夫曼树**

现在我来一步步演示合并过程。请大家跟着我画：

第1轮：选取概率最小的两个：G(0.04)和D(0.05)，合并得到新节点，概率0.09
剩余：C(0.47), B(0.18), A(0.10), F(0.10), 新节点(0.09), E(0.06)

第2轮：选取最小的两个：E(0.06)和新节点(0.09)，合并得到0.15
剩余：C(0.47), B(0.18), 新节点(0.15), A(0.10), F(0.10)

第3轮：选取最小的两个：A(0.10)和F(0.10)，合并得到0.20
剩余：C(0.47), 新节点(0.20), B(0.18), 新节点(0.15)

第4轮：选取最小的两个：0.15和B(0.18)，合并得到0.33
剩余：C(0.47), 新节点(0.33), 新节点(0.20)

第5轮：选取最小的两个：0.20和0.33，合并得到0.53
剩余：新节点(0.53), C(0.47)

第6轮：合并最后两个：0.47和0.53，得到根节点1.00

**第四步：分配码字**

在树上，每个左分支标0，右分支标1。

**第五步：得到编码结果**

| 符号 | 概率 | 编码 | 码长 |
|------|------|------|------|
| C | 0.47 | 0 | 1 |
| B | 0.18 | 10 | 2 |
| A | 0.10 | 110 | 3 |
| F | 0.10 | 111 | 3 |
| E | 0.06 | 1100 | 4 |
| D | 0.05 | 11010 | 5 |
| G | 0.04 | 11011 | 5 |

大家看，概率最高的C只用1位，概率最低的G用5位。

### 2.4 平均码长计算

我们来算一下平均每个符号需要多少位：

**平均码长 = Σ(概率 × 码长)**

= 0.47×1 + 0.18×2 + 0.10×3 + 0.10×3 + 0.06×4 + 0.05×5 + 0.04×5
= 0.47 + 0.36 + 0.30 + 0.30 + 0.24 + 0.25 + 0.20
= **2.12 位/符号**

如果用等长编码呢？7个符号需要至少3位（因为2³=8≥7）。

所以，霍夫曼编码比等长编码节省了：(3-2.12)/3 ≈ **29%**！

这就是压缩的效果。

---

## 【第三部分：霍夫曼编码在WSN中的应用】（5分钟）

在无线传感器网络中，霍夫曼编码可以怎么用呢？

想象一个温度监测系统。传感器测量的温度大多在20-25摄氏度之间（比如室温），这个范围的温度值出现概率可能占80%。而极端温度（比如0度以下或40度以上）很少出现。

我们可以统计一段时间的温度数据，得到各温度值的出现概率，然后用霍夫曼编码。常见的温度用短码，罕见的温度用长码。

这样做的好处是：
- 减少传输数据量
- 减少发射时间
- **节省电池能量**

这对于电池供电的传感器节点来说非常重要。

---

## 【本课时小结】（5分钟）

今天我们学习了信源编码，重点掌握霍夫曼编码：

1. **信源编码的目的**：压缩数据，提高传输效率

2. **霍夫曼编码的思想**：高频符号用短码，低频符号用长码

3. **霍夫曼编码五步流程**：
   - 统计概率
   - 排序
   - 构造霍夫曼树
   - 分配码字
   - 生成编码

4. **平均码长 = Σ(概率 × 码长)**

5. **霍夫曼编码在WSN中的应用**：压缩传感器数据，节省能量

**课后练习**：请对以下符号进行霍夫曼编码：
A(0.25), B(0.25), C(0.20), D(0.15), E(0.15)

下节课我们学习信道编码。信源编码是"减少冗余"，信道编码是"增加冗余"——看起来矛盾，其实目的不同。请思考一下为什么？

---

# 第4课时：2.2.4 信道编码（50分钟）

## 【课前回顾】（5分钟）

同学们好！上节课我们学习了信源编码，核心是什么？对，**减少冗余，压缩数据**。

那我问大家一个问题：如果压缩后的数据在传输过程中出错了，比如某一位从0变成了1，怎么办？

这就是今天要学的**信道编码**。

信源编码去掉冗余，信道编码**增加冗余**。听起来矛盾，但目的不同：
- 信源编码去掉的是**无用的冗余**，为了提高效率
- 信道编码增加的是**有用的冗余**，为了提高可靠性

打个比方：你给朋友发消息说"明天9点见"，这是信源编码后的精简信息。但如果怕对方听错，你可能会说"明天上午9点钟见，就是9点整哦"——这就是信道编码，多说几遍确保对方听清楚。

---

## 【第一部分：信道编码概念】（10分钟）

### 1.1 定义与目的

**信道编码**：通过增加冗余信息，使接收端能够检测甚至纠正传输中的错误。

目的很简单：**提高传输可靠性**。

### 1.2 信源编码与信道编码对比

| | 信源编码 | 信道编码 |
|---|----------|----------|
| 冗余 | 减少 | 增加 |
| 目的 | 提高效率 | 提高可靠性 |
| 数据量 | 变小 | 变大 |
| 执行顺序 | 先 | 后 |

在发送端，处理顺序是：原始数据 → 信源编码（压缩）→ 信道编码（加保护）→ 调制 → 发射

在接收端，顺序反过来。

### 1.3 为什么能检错纠错？

关键在于**冗余**。

举个最简单的例子：你要传一个比特，可以把它发三遍。如果接收到"001"，你可以判断原始数据应该是0（少数服从多数）。这就是利用冗余来纠错。

当然，实际的信道编码比这个复杂得多，效率也高得多。

---

## 【第二部分：香农定理】（15分钟）

在学习具体的编码方法之前，我们先了解一个重要的理论基础——**香农定理**。

### 2.1 信道容量

香农在1948年提出了一个著名的公式：

**C = B × log₂(1 + S/N)**

其中：
- C：信道容量，单位是比特每秒（bps）
- B：信道带宽，单位是赫兹（Hz）
- S/N：信噪比

这个公式告诉我们：**一个有噪声的信道，存在一个最大传输速率，只要不超过这个速率，理论上可以实现无差错传输**。

注意，是"理论上"。实现这个目标需要无限长的码字和无限复杂的编解码算法。实际中只能接近这个极限。

### 2.2 香农定理的启示

从这个公式我们可以得出几个重要结论：

**第一，信噪比越高，信道容量越大。** 这很直观，信号越清晰，传输速率越高。

**第二，带宽和信噪比可以互换。** 信噪比不够？可以用更多带宽来弥补。这就是扩频通信的理论基础。

**第三，只要传输速率不超过信道容量，理论上可以无差错传输。** 信道编码的目标就是尽可能接近这个极限。

### 2.3 信道类型（简介）

简单介绍两种常见的信道模型：

**二元对称信道（BSC）**：
- 传输0和1
- 发0可能收到1（错误），发1可能收到0（错误）
- 错误概率是对称的

**二元删除信道（BEC）**：
- 信息可能丢失（收到"？"表示不知道）
- 但不会传错（不会把0变成1）

无线信道更接近BSC模型。

---

## 【第三部分：奇偶校验码】（15分钟）

理论讲完了，我们来看一个最简单的信道编码方法——**奇偶校验码**。

### 3.1 基本原理

思路非常简单：在数据后面加一位校验位，使得所有位中"1"的个数为奇数或偶数。

- **奇校验**：保证"1"的总个数是奇数
- **偶校验**：保证"1"的总个数是偶数

接收端统计"1"的个数，如果不符合约定的奇偶性，就说明有错误。

### 3.2 例题

**题目**：数据为"011001101"（9位），分别构造奇校验码和偶校验码。

**解答**：

先数一下原数据有几个1：0+1+1+0+0+1+1+0+1 = 5个1（奇数）

**奇校验**：已经是奇数个1，校验位加0，保持奇数
结果：011001101**0**

**偶校验**：要变成偶数个1，校验位加1
结果：011001101**1**

接收端收到数据后，数一下1的个数：
- 如果是奇校验，1的个数应该是奇数
- 如果是偶校验，1的个数应该是偶数
- 不符合就说明有错误

### 3.3 奇偶校验的特点

**优点：**
- 实现简单，只需要几个异或门
- 开销小，只增加1位

**缺点：**
- 只能检测奇数个错误，不能检测偶数个错误
- 不能纠错，只能检错
- 不知道哪一位出错

虽然简单，但在低误码率场景下够用了。很多简单的传感器协议就用奇偶校验。

### 3.4 其他编码方法（简介）

实际应用中有更强大的编码方法：

| 编码方法 | 特点 | 应用场景 |
|----------|------|----------|
| CRC（循环冗余校验）| 检错能力强，广泛使用 | 网络通信、存储 |
| 卷积码 | 可以纠错，复杂度中等 | 早期移动通信 |
| LDPC（低密度奇偶校验码）| 接近香农极限 | 5G、WiFi 6 |
| Turbo码 | 高性能，但延迟大 | 4G LTE |

这些内容通信专业课程会详细学习，我们了解即可。

---

## 【本课时小结】（5分钟）

今天我们学习了信道编码的基本概念：

1. **信道编码的目的**：增加冗余，提高传输可靠性

2. **香农定理**：C = B × log₂(1 + S/N)，告诉我们信道容量的上限

3. **香农定理的启示**：
   - 信噪比越高，容量越大
   - 带宽和信噪比可以互换

4. **奇偶校验码**：
   - 最简单的检错方法
   - 只能检测奇数个错误
   - 不能纠错

5. **信源编码在前，信道编码在后**

下节课我们学习信号调制——如何把数字信号变成无线电波发送出去。请预习ASK、FSK、PSK三种调制方式。

---

# 第5课时：2.2.5 信号调制与扩频通信（50分钟）

## 【课前回顾与引入】（5分钟）

同学们好！前面我们学习了信源编码和信道编码。

现在，我们有了经过编码处理的数据——一串0和1。但问题是，这些0和1怎么通过无线电波发送出去呢？

你可能想：直接发不就行了？

不行的。原因是**天线尺寸问题**。

有效的天线长度大约是信号波长的四分之一。假设我们的数据速率是1kbps，基带信号频率大约1kHz，对应波长300公里。四分之一也有75公里！这么长的天线怎么造？

但如果我们把信号"搬"到2.4GHz的载波上呢？2.4GHz对应波长12.5厘米，四分之一就是3厘米左右。这就可以做成很小的天线了。

这个"搬运"的过程，就叫做**调制**。

---

## 【第一部分：调制基础】（5分钟）

### 1.1 什么是调制？

**调制**：用调制信号（我们的数据）去控制载波的某个参数，使载波随调制信号变化。

载波是什么？就是一个高频的正弦波，可以写成：

**载波 = A × cos(2πft + φ)**

其中：
- A：幅度
- f：频率
- φ：相位

调制就是用我们的数据去控制这三个参数中的一个或多个。

### 1.2 为什么需要调制？

三个原因：

**第一，减小天线尺寸。** 刚才说了，高频信号需要的天线小。

**第二，频分复用。** 不同的信号调制到不同的载波频率上，就可以同时传输，互不干扰。收音机能收到不同电台，就是这个原理。

**第三，提高抗干扰能力。** 某些调制方式比直接传输基带信号更抗干扰。

---

## 【第二部分：三种基本调制方式】（20分钟）

数字调制有三种基本方式，分别控制载波的三个参数：

### 2.1 幅移键控（ASK）

**ASK = Amplitude Shift Keying**

原理：用数据控制载波的**幅度**。
- 数据是1：发送正常幅度的载波
- 数据是0：发送零幅度（或小幅度）

最简单的形式叫OOK（On-Off Keying）：
- 1：发送载波（开）
- 0：不发送（关）

**优点**：实现最简单
**缺点**：抗干扰能力差，因为幅度最容易受噪声影响

你可以想象成手电筒：亮表示1，灭表示0。但如果有雾霾（干扰），亮度就会被影响。

### 2.2 频移键控（FSK）

**FSK = Frequency Shift Keying**

原理：用数据控制载波的**频率**。
- 数据是1：发送频率f₁
- 数据是0：发送频率f₂

**优点**：抗干扰能力比ASK好，因为频率比较稳定
**缺点**：需要更大的带宽（因为用了两个频率）

你可以想象成鸟叫：高音表示1，低音表示0。即使在嘈杂环境中，高音和低音还是能分辨。

### 2.3 相移键控（PSK）

**PSK = Phase Shift Keying**

原理：用数据控制载波的**相位**。
- 数据是1：发送相位0°的载波
- 数据是0：发送相位180°的载波（正好反相）

**优点**：抗干扰能力最好
**缺点**：实现复杂，需要相干解调

相位变化人眼看不出来，但接收机可以检测到。180度的相位差就是波形上下翻转。

### 2.4 三种方式对比

| 特性 | ASK | FSK | PSK |
|------|-----|-----|-----|
| 控制参数 | 幅度 | 频率 | 相位 |
| 抗噪能力 | 差 | 中 | 好 |
| 带宽效率 | 高 | 低 | 高 |
| 实现复杂度 | 低 | 中 | 高 |
| 典型应用 | 低功耗近距离 | 常用 | 高可靠场景 |

在无线传感器网络中，FSK和PSK用得比较多。ASK主要用于超低功耗、近距离的场景，比如遥控器。

---

## 【第三部分：扩频通信】（15分钟）

### 3.1 什么是扩频通信？

扩频通信的思想是：**把窄带信号扩展成宽带信号传输，接收端再恢复成窄带**。

为什么要这样做？回顾香农公式：C = B × log₂(1 + S/N)

如果信噪比（S/N）低，可以用更大的带宽（B）来弥补。这就是**用带宽换信噪比**。

### 3.2 扩频通信的优点

**第一，抗干扰能力强。** 干扰信号通常是窄带的，扩频后的信号分布在很宽的频带上，窄带干扰只能影响一小部分。

**第二，抗多径衰落。** 多径效应对窄带信号影响大，但宽带信号更能抵抗。

**第三，低功率谱密度。** 把同样的功率分散到更宽的频带上，功率谱密度就低了。好处是隐蔽性好，不容易被检测到。

**第四，支持码分多址（CDMA）。** 不同用户用不同的扩频码，可以在同一频带上同时通信。

**第五，保密性好。** 没有扩频码就无法正确解调。

### 3.3 两种扩频方式

**直接序列扩频（DSSS）**：

原理：把数据信号和一个高速的伪随机码相乘，频谱就被展宽了。接收端用相同的伪随机码再乘一次，就能恢复原信号。

特点：处理增益高，抗干扰能力强。
应用：GPS、CDMA手机、ZigBee。

**跳频扩频（FHSS）**：

原理：载波频率按照伪随机规律快速跳变。每次只用一个窄带频率，但频率不断变化。

特点：跳频避开干扰，即使某个频点被干扰，跳到下一个就好了。
应用：蓝牙、部分军用通信。

### 3.4 DSSS与FHSS对比

| | DSSS | FHSS |
|---|------|------|
| 扩频方式 | 用伪随机码直接扩展 | 载波频率跳变 |
| 抗干扰原理 | 处理增益 | 跳频躲避 |
| 同步要求 | 高 | 中 |
| 典型应用 | ZigBee、GPS | 蓝牙 |

---

## 【本课时小结】（5分钟）

今天我们学习了调制和扩频通信：

1. **调制的作用**：把基带信号搬到高频载波上，便于天线发射

2. **三种调制方式**：
   - ASK：控制幅度，简单但抗干扰差
   - FSK：控制频率，抗干扰中等
   - PSK：控制相位，抗干扰最好但复杂

3. **扩频通信**：用带宽换信噪比，提高抗干扰能力

4. **两种扩频方式**：DSSS（码扩频）和FHSS（跳频）

下节课是本章的最后一课，我们将学习具体的短距离无线通信技术，重点是ZigBee和LoRa。这两个技术是无线传感器网络最常用的。

---

# 第6课时：2.2.6 短距离无线通信技术（50分钟）

## 【课前回顾与引入】（5分钟）

同学们好！经过前五节课的学习，我们已经掌握了物理层的基础知识：
- 物理层的功能和设计要求
- 无线信道特性
- 信源编码（霍夫曼编码）
- 信道编码（奇偶校验）
- 调制技术（ASK/FSK/PSK）
- 扩频通信（DSSS/FHSS）

今天是本章的最后一节课。我们要把这些理论知识和实际技术结合起来，看看实际的无线传感器网络用什么通信技术。

无线传感器网络对通信技术有什么需求？
- 低功耗：电池要用很久
- 低成本：节点要便宜
- 合适的传输距离：室内几十米，室外可能几公里
- 合适的数据速率：传感器数据不大，不需要很高速率

市面上有很多无线通信技术，哪些适合WSN呢？

---

## 【第一部分：技术概览】（5分钟）

我们先看一张对比表：

| 技术 | 频段 | 速率 | 距离 | 功耗 | WSN适用性 |
|------|------|------|------|------|-----------|
| **ZigBee** | 2.4GHz | 250kbps | 10-100m | 极低 | ★★★★★ |
| **LoRa** | 433/868/915MHz | 0.3-50kbps | 2-15km | 低 | ★★★★★ |
| BLE | 2.4GHz | 1Mbps | 10-100m | 低 | ★★★☆☆ |
| WiFi | 2.4/5GHz | 11Mbps+ | 50-100m | 高 | ★★☆☆☆ |
| UWB | 3.1-10.6GHz | 100Mbps+ | <10m | 低 | ★★★☆☆ |

可以看到，**ZigBee和LoRa**是最适合WSN的两种技术。今天我们重点学习这两个。

---

## 【第二部分：ZigBee技术详解】（15分钟）

### 2.1 ZigBee是什么？

ZigBee是一种**短距离、低功耗、低速率**的无线通信技术。

名字来源很有趣：蜜蜂（Bee）用"之字形"（Zig-zag）飞行来传递信息。ZigBee网络中的数据就像蜜蜂一样，在节点之间跳来跳去。

ZigBee基于**IEEE 802.15.4标准**。802.15.4定义了物理层和MAC层，ZigBee联盟在此基础上定义了网络层和应用层。

### 2.2 ZigBee的技术特点

**低功耗**：这是ZigBee最大的优势。一节5号电池可以用几个月甚至几年。怎么做到的？靠低占空比——大部分时间休眠，只在需要时唤醒。

**低速率**：最高250kbps。看起来很慢，但对于传感器数据足够了。温度、湿度这些数值，一次传几十字节就够了。

**低成本**：芯片便宜，几块钱一片。因为协议简单，不需要复杂的硬件。

**大容量**：一个ZigBee网络理论上可以支持65000多个节点。这对于大规模传感器网络非常重要。

**自组网**：节点可以自动组网，不需要人工配置。支持多种网络拓扑。

### 2.3 ZigBee协议栈

ZigBee的协议栈分为四层：

```
┌─────────────────────┐
│   应用层（APL）      │
├─────────────────────┤
│   网络层（NWK）      │  ← ZigBee联盟定义
├─────────────────────┤
│   MAC层             │
├─────────────────────┤  ← IEEE 802.15.4定义
│   物理层（PHY）      │
└─────────────────────┘
```

物理层和MAC层由IEEE标准定义，保证了不同厂家产品的互通性。网络层和应用层由ZigBee联盟定义，提供了组网和应用支持。

### 2.4 ZigBee网络拓扑

ZigBee支持三种网络拓扑：

**星型拓扑**：所有节点都和中心节点通信。简单，但中心节点负担重，一旦失效整个网络瘫痪。

**树型拓扑**：层次结构，像一棵树。扩展性好，但路径固定，不够灵活。

**网状拓扑（Mesh）**：节点之间可以任意通信。最可靠，因为有多条路径，一条不通可以走另一条。这叫**自愈能力**。

大多数ZigBee网络使用Mesh拓扑。

### 2.5 ZigBee应用场景

- **智能家居**：灯泡、插座、门锁、传感器
- **工业自动化**：设备监测、状态采集
- **环境监测**：温湿度、空气质量
- **医疗健康**：生理参数采集

---

## 【第三部分：LoRa技术详解】（15分钟）

### 3.1 LoRa是什么？

LoRa是**Long Range**的缩写，顾名思义，最大特点是**传输距离远**。

LoRa使用一种叫**CSS（啁啾扩频）** 的调制技术。啁啾（Chirp）是一种频率随时间变化的信号，可以理解为"频率滑动"。

LoRa属于**LPWAN（低功耗广域网）** 技术，适合长距离、低功耗的场景。

### 3.2 LoRa的技术特点

**远距离**：城市环境2-5公里，郊区空旷地带可达15公里以上。这是ZigBee无法比拟的。

**低功耗**：电池可以用几年。虽然传得远，但发射功率不高，靠的是扩频增益。

**低速率**：0.3kbps到50kbps。速率低是远距离的代价，鱼和熊掌不可兼得。

**强抗干扰**：CSS扩频技术抗干扰能力强，可以在低于噪声电平的信号中提取信息。

**穿透力强**：使用低频段（433/868/915MHz），穿透建筑物的能力比2.4GHz强。

### 3.3 LoRa与ZigBee对比

这是两种最常用的WSN通信技术，各有所长：

| | ZigBee | LoRa |
|---|--------|------|
| 传输距离 | 10-100米 | 2-15公里 |
| 数据速率 | 250kbps | 0.3-50kbps |
| 频段 | 2.4GHz | 433/868/915MHz |
| 适用场景 | 室内、密集部署 | 广域、稀疏部署 |
| 网络拓扑 | Mesh自组网 | 星型为主 |
| 典型应用 | 智能家居 | 智慧城市、农业 |

简单记忆：
- **ZigBee**：短距离，但节点多，能自组网
- **LoRa**：长距离，但节点少，主要星型

### 3.4 LoRaWAN网络架构

LoRa只是物理层技术，要组网需要LoRaWAN协议。

LoRaWAN的架构是：

**终端节点 → 网关 → 服务器 → 应用**

终端节点通过LoRa无线连接到网关，网关通过互联网连接到云端服务器。一个网关可以覆盖几公里范围内的成千上万个节点。

### 3.5 LoRa应用场景

- **智慧城市**：水表、电表、气表远程抄读
- **智慧农业**：大面积农田的土壤监测、灌溉控制
- **物流追踪**：货物位置跟踪
- **环境监测**：森林火灾预警、水质监测

---

## 【第四部分：其他技术简介】（5分钟）

简单介绍其他几种技术：

**超宽带（UWB）**：
- 超大带宽（>500MHz），可实现厘米级定位精度
- 应用：室内定位、智能车钥匙

**蓝牙（Bluetooth）**：
- BLE（低功耗蓝牙）功耗低
- 应用：可穿戴设备、无线耳机

**WiFi**：
- 速率高，但功耗也高
- 应用：需要大数据量传输的场景，如视频监控

**红外**：
- 需要视距通信，不能穿墙
- 应用：电视遥控器

---

## 【第五部分：2.2节总结】（5分钟）

同学们，我们用6节课学完了物理层技术。让我们回顾一下整体知识框架：

```
2.2 物理层技术
├── 2.2.1 物理层概述
│   └── 功能、特性、设计要求
├── 2.2.2 无线电波与信道
│   └── 传播特性、信道模型、ISM频段
├── 2.2.3 信源编码
│   └── 霍夫曼编码（五步流程）
├── 2.2.4 信道编码
│   └── 香农定理、奇偶校验码
├── 2.2.5 调制与扩频
│   └── ASK/FSK/PSK、DSSS/FHSS
└── 2.2.6 短距离通信技术
    └── ZigBee、LoRa
```

**核心知识点：**

1. 物理层负责比特流传输，面临多种信道挑战
2. 信源编码压缩数据（霍夫曼编码），信道编码提高可靠性
3. 调制将基带信号搬到高频载波上
4. 扩频通信用带宽换信噪比
5. ZigBee适合短距离密集部署，LoRa适合长距离广域部署

下一节我们将学习数据链路层，它解决的是"如何在多个节点间共享信道"的问题。

谢谢大家！有问题可以课后来找我。
