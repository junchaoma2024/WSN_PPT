# 第二章 2.3 MAC层技术介绍 - 备课笔记（提纲版）

## 课程信息
- **课程名称**：传感器网络技术与应用
- **章节**：第2章 2.3 MAC层技术介绍
- **课时**：6课时（300分钟），每2课时为1节课，共3节课
- **学生背景**：已学习2.2节物理层内容，了解无线信道特性和调制技术

## 教学目标
1. 理解数据链路层的功能和在WSN协议栈中的位置
2. 掌握MAC协议的分类方法（静态vs动态、基于竞争vs基于调度）
3. 深入理解CSMA/CD的原理及其在无线网络中的局限性
4. 掌握CSMA/CA的工作机制（RTS/CTS、NAV、退避算法）
5. 掌握S-MAC、T-MAC等WSN专用MAC协议的设计思想和核心机制
6. 能够根据应用场景选择合适的MAC协议

## 重难点
- **重点**：隐蔽站/暴露站问题、RTS/CTS机制、S-MAC周期性睡眠、T-MAC自适应机制
- **难点**：理解为什么CSMA/CD不适合无线网络、Z-MAC的混合调度机制

---

# 第一节课（100分钟）：数据链路层概述与MAC协议分类

---

## 第1课时：2.3.1 数据链路层概述（50分钟）

### 一、课程引入（5分钟）

#### 内容要点
- 回顾OSI七层模型和2.2节物理层内容
- 物理层解决"如何传输比特"，数据链路层解决"如何可靠传输帧"
- 引出问题：多个节点如何共享同一个无线信道？

#### 衔接语
> "上一节我们学习了物理层，知道了比特是如何通过无线电波传输的。但是，如果多个传感器节点同时发送数据会怎样？会不会'打架'？今天我们学习数据链路层，看看它是如何解决这个问题的。"

---

### 二、数据链路层定义与功能（15分钟）

#### 2.1 数据链路层定义

**内容要点**：
- 位于物理层之上、网络层之下
- 将物理层提供的可能出错的物理连接，改造成逻辑上无差错的数据链路
- 以"帧"为单位传输数据

**教学建议**：
- 用"快递包装"类比：物理层是道路，数据链路层是包装和运输规则

#### 2.2 数据链路层主要功能

**内容要点**（五大功能）：

| 功能 | 说明 | 类比 |
|------|------|------|
| 封装成帧 | 将网络层数据加上帧头帧尾 | 给信件装信封 |
| 透明传输 | 特殊字符的转义处理 | 避免歧义 |
| 差错控制 | 检测和纠正传输错误 | 核对收据 |
| 流量控制 | 控制发送速率 | 别发太快 |
| 链路管理 | 建立、维护、释放链路 | 打电话流程 |

---

### 三、帧结构与MAC地址（10分钟）

#### 3.1 帧结构

**内容要点**：
```
┌────────┬────────┬────────┬────────┬────────┐
│ 帧首部 │ 目的地址 │ 源地址 │ 数据 │ FCS │
└────────┴────────┴────────┴────────┴────────┘
```

- 帧首部：帧定界、同步
- 地址：MAC地址（48位）
- 数据：上层交付的数据
- FCS：帧校验序列

#### 3.2 MAC地址

**内容要点**：
- 48位（6字节），通常写成12位十六进制
- 格式：XX:XX:XX:XX:XX:XX
- 前24位：厂商标识（OUI）
- 后24位：设备标识
- 全球唯一

**教学建议**：
- 展示真实的MAC地址示例
- 让学生查看自己手机/电脑的MAC地址

---

### 四、IEEE 802参考模型（10分钟）

#### 4.1 LLC与MAC子层

**内容要点**：
```
┌─────────────────────────┐
│      网络层              │
├─────────────────────────┤
│  LLC子层（逻辑链路控制）  │ ← 提供统一接口
├─────────────────────────┤
│  MAC子层（介质访问控制）  │ ← 解决信道竞争
├─────────────────────────┤
│      物理层              │
└─────────────────────────┘
```

- LLC子层：向上提供统一接口，屏蔽不同MAC的差异
- MAC子层：解决多个节点如何共享信道的问题

#### 4.2 为什么需要MAC？

**内容要点**：
- 无线信道是共享的广播信道
- 多个节点同时发送会产生冲突
- 需要协调机制——这就是MAC协议

---

### 五、差错控制（5分钟）

#### 5.1 差错控制方法

**内容要点**：

| 方法 | 原理 | 特点 |
|------|------|------|
| CRC | 循环冗余校验 | 检错能力强 |
| FEC | 前向纠错 | 可以纠错 |
| ARQ | 自动重传请求 | 确认+重传 |

**衔接语**：
> "了解了数据链路层的基本功能，接下来我们重点学习MAC协议——如何让多个节点公平、高效地共享无线信道。"

---

### 六、本课时小结（5分钟）

#### 知识点回顾
1. 数据链路层位于物理层之上，以帧为单位传输
2. 五大功能：封装成帧、透明传输、差错控制、流量控制、链路管理
3. MAC地址：48位，全球唯一
4. IEEE 802模型将数据链路层分为LLC和MAC两个子层
5. MAC子层解决信道共享问题

---

## 第2课时：2.3.2 MAC协议分类与静态协议（50分钟）

### 一、MAC协议发展历史（10分钟）

#### 1.1 ALOHA协议

**内容要点**：
- 1968年，夏威夷大学Norman Abramson
- 最早的无线计算机通信网络
- 纯ALOHA：想发就发，碰撞则重传
- 时隙ALOHA：只能在时隙开始时发送

**意义**：
- 开创了随机接入的先河
- 是所有现代MAC协议的鼻祖

#### 1.2 发展脉络

**内容要点**：
```
ALOHA (1968)
    ↓
CSMA (1970s) ← 先听后发
    ↓
CSMA/CD (1980s) ← 边听边发，用于以太网
    ↓
CSMA/CA (1990s) ← 避免碰撞，用于WiFi
    ↓
S-MAC/T-MAC (2000s) ← WSN专用，节能优先
```

---

### 二、MAC协议分类（15分钟）

#### 2.1 分类方法一：静态 vs 动态

**内容要点**：

| 类型 | 特点 | 代表协议 |
|------|------|----------|
| 静态MAC | 预先分配资源，无冲突 | TDMA, FDMA, CDMA |
| 动态MAC | 按需竞争资源，可能冲突 | CSMA/CD, CSMA/CA |

#### 2.2 分类方法二：基于竞争 vs 基于调度

**内容要点**：

| 类型 | 原理 | 优点 | 缺点 |
|------|------|------|------|
| 基于竞争 | 节点竞争信道 | 灵活，适应性强 | 可能冲突 |
| 基于调度 | 预先分配时隙/频率 | 无冲突 | 不够灵活 |

#### 2.3 WSN MAC协议分类

**内容要点**：
```
WSN MAC协议
├── 基于竞争（Contention-based）
│   ├── S-MAC
│   ├── T-MAC
│   └── SIFT
├── 基于调度（Schedule-based）
│   ├── TDMA
│   ├── TRAMA
│   └── SMACS/EAR
└── 混合型（Hybrid）
    └── Z-MAC
```

---

### 三、静态MAC协议（20分钟）

#### 3.1 TDMA（时分多址）

**内容要点**：
```
时间轴：
|--节点A--|--节点B--|--节点C--|--节点A--|--节点B--|--节点C--|
|<------- 一个周期 ------->|

特点：
- 每个节点分配固定时隙
- 只在自己的时隙内发送
- 无碰撞
```

**优点**：无冲突、可预测延迟、节能（非时隙可休眠）
**缺点**：需要同步、时隙固定不灵活、空闲时隙浪费

#### 3.2 FDMA（频分多址）

**内容要点**：
```
频率轴：
    ┌─────┐
频率1│节点A│
    ├─────┤
频率2│节点B│
    ├─────┤
频率3│节点C│
    └─────┘

特点：
- 每个节点分配不同频率
- 同时发送，互不干扰
```

**优点**：简单、无碰撞
**缺点**：频谱利用率低、需要保护间隔

#### 3.3 CDMA（码分多址）

**内容要点**：
- 回顾2.2节的扩频通信
- 每个节点使用不同的扩频码
- 所有节点可以同时在同一频率发送
- 接收端通过码字区分不同发送者

**优点**：频谱效率高、抗干扰
**缺点**：实现复杂、远近效应

#### 3.4 静态协议对比

**内容要点**：

| 协议 | 分配资源 | 优点 | 缺点 | WSN适用性 |
|------|----------|------|------|-----------|
| TDMA | 时间 | 无冲突 | 需同步 | 高 |
| FDMA | 频率 | 简单 | 浪费频谱 | 低 |
| CDMA | 码字 | 效率高 | 复杂 | 中 |

---

### 四、本课时小结（5分钟）

#### 知识点回顾
1. ALOHA是MAC协议的鼻祖（1968年）
2. MAC协议分类：静态/动态、竞争/调度
3. TDMA：时分复用，每个节点固定时隙
4. FDMA：频分复用，每个节点固定频率
5. CDMA：码分复用，用扩频码区分

#### 衔接语
> "静态MAC协议虽然无冲突，但不够灵活。下节课我们学习动态MAC协议——CSMA，看看它是如何让节点'先听后发'的。"

---

# 第二节课（100分钟）：CSMA/CD与CSMA/CA协议

---

## 第3课时：2.3.3 CSMA/CD协议（50分钟）

### 一、课前回顾与引入（5分钟）

#### 回顾要点
- MAC协议分类：静态vs动态
- 静态MAC（TDMA/FDMA/CDMA）：预分配，无冲突
- 动态MAC：按需竞争，更灵活

#### 引入问题
> "静态MAC需要预先分配资源，不够灵活。有没有一种协议，让节点自己判断什么时候可以发送？这就是CSMA——先听后发。"

---

### 二、CSMA基本原理（10分钟）

#### 2.1 CSMA定义

**内容要点**：
- CSMA = Carrier Sense Multiple Access
- 载波侦听多路访问
- 核心思想：**先听后发**

#### 2.2 CSMA工作流程

**内容要点**：
```
发送数据前：
1. 侦听信道
2. 如果信道空闲 → 发送数据
3. 如果信道忙 → 等待

类比：
想说话前先听听别人有没有在说
```

#### 2.3 CSMA的三种策略

**内容要点**：

| 策略 | 信道忙时 | 特点 |
|------|----------|------|
| 1-坚持 | 持续侦听，空闲立即发 | 冲突概率高 |
| 非坚持 | 随机等待后重试 | 信道利用率低 |
| p-坚持 | 以概率p发送 | 折中方案 |

---

### 三、CSMA/CD协议详解（15分钟）

#### 3.1 CSMA/CD定义

**内容要点**：
- CSMA/CD = CSMA with Collision Detection
- 带碰撞检测的载波侦听多路访问
- 用于**有线以太网**（IEEE 802.3）

#### 3.2 CSMA/CD三大特征

**内容要点**：

| 特征 | 含义 | 作用 |
|------|------|------|
| 先听后发 | 发送前侦听信道 | 避免明显冲突 |
| 边听边发 | 发送时继续侦听 | 检测碰撞 |
| 碰撞停止 | 检测到碰撞立即停止 | 减少信道浪费 |

#### 3.3 CSMA/CD工作流程

**内容要点**：
```
┌─────────────────┐
│   准备发送数据   │
└────────┬────────┘
         ↓
┌─────────────────┐
│   侦听信道状态   │
└────────┬────────┘
         ↓
    ┌────┴────┐
    │ 信道空闲？│
    └────┬────┘
     是  │  否
    ┌────┘  └────┐
    ↓            ↓
┌───────┐   ┌───────┐
│ 发送帧 │   │  等待  │
└───┬───┘   └───────┘
    ↓
┌─────────────────┐
│ 边发边听检测碰撞 │
└────────┬────────┘
         ↓
    ┌────┴────┐
    │ 有碰撞？ │
    └────┬────┘
     是  │  否
    ┌────┘  └────┐
    ↓            ↓
┌───────┐   ┌───────┐
│发送jam │   │发送成功│
│信号停止│   └───────┘
└───┬───┘
    ↓
┌─────────────────┐
│ 二进制指数退避  │
│   等待后重试    │
└─────────────────┘
```

---

### 四、CSMA/CD的局限性（15分钟）★★

#### 4.1 隐蔽站问题（Hidden Terminal）

**内容要点**：
```
场景设置：
- A和C都在B的通信范围内
- A和C互相听不到对方

     A的范围          C的范围
    ┌────────┐      ┌────────┐
    │   [A]──────►[B]◄──────[C]│
    └────────┘      └────────┘

问题发生：
1. A开始发送数据给B
2. C侦听信道 → 检测为空闲（听不到A）
3. C开始发送数据给B
4. B处发生碰撞！

结论：C对A来说是"隐蔽站"
```

**教学建议**：
- 画图演示三个节点的位置关系
- 强调"听不到≠没有在发送"

#### 4.2 暴露站问题（Exposed Terminal）

**内容要点**：
```
场景设置：
- B正在发送数据给A
- C想发送数据给D
- C能听到B的发送

    [A]◄──────[B]──────►[C]──────►[D]
         正在传输    想要传输

问题发生：
1. B正在发送给A
2. C侦听信道 → 检测为忙（听到B）
3. C推迟发送给D
4. 但实际上：C发给D不会干扰B发给A！

结论：B对C来说造成了"暴露"问题
       C不必要地推迟了发送
```

**教学建议**：
- 强调暴露站问题导致信道利用率降低
- 与隐蔽站问题形成对比

#### 4.3 为什么CSMA/CD不适合无线网络？

**内容要点**：

| 问题 | 原因 |
|------|------|
| 碰撞检测困难 | 无线信号衰减快，发送时难以检测弱碰撞信号 |
| 隐蔽站问题 | 无线传播范围有限，存在听不到的区域 |
| 暴露站问题 | 导致不必要的等待，降低效率 |
| 半双工限制 | 无线设备通常不能同时收发 |

**衔接语**：
> "CSMA/CD在无线网络中存在这些问题，该怎么解决？这就是CSMA/CA——碰撞避免而不是碰撞检测。"

---

### 五、本课时小结（5分钟）

#### 知识点回顾
1. CSMA核心思想：先听后发
2. CSMA/CD三大特征：先听后发、边听边发、碰撞停止
3. 隐蔽站问题：听不到不代表没有发送 ★
4. 暴露站问题：听得到不代表会干扰 ★
5. CSMA/CD不适合无线网络

---

## 第4课时：2.3.4 CSMA/CA协议（50分钟）

### 一、CSMA/CA概述（5分钟）

#### 1.1 定义

**内容要点**：
- CSMA/CA = CSMA with Collision Avoidance
- 带碰撞**避免**的载波侦听多路访问
- 用于**无线网络**（IEEE 802.11 WiFi）

#### 1.2 设计思想

**内容要点**：
- 无线网络难以检测碰撞 → 改为**避免**碰撞
- 通过预约机制减少碰撞概率
- 即使信道空闲也要随机等待

---

### 二、CSMA/CD vs CSMA/CA（5分钟）

**内容要点**：

| 特性 | CSMA/CD | CSMA/CA |
|------|---------|---------|
| 碰撞处理 | 检测 | 避免 |
| 应用场景 | 有线以太网 | 无线网络 |
| ACK确认 | 无 | 有 |
| 信道空闲时 | 立即发送 | 随机等待后发送 |
| 隐蔽站解决 | 无 | RTS/CTS |

---

### 三、帧间间隔（10分钟）

#### 3.1 IFS定义

**内容要点**：
- IFS = Inter-Frame Space，帧间间隔
- 不同类型的帧有不同的优先级
- 优先级通过IFS长度体现

#### 3.2 四种IFS

**内容要点**：

| IFS类型 | 全称 | 长度 | 用途 |
|---------|------|------|------|
| SIFS | Short IFS | 最短 | ACK、CTS（最高优先级） |
| PIFS | PCF IFS | 中等 | 点协调功能 |
| DIFS | DCF IFS | 较长 | 普通数据帧 |
| EIFS | Extended IFS | 最长 | 错误恢复 |

**时序图**：
```
优先级：SIFS > PIFS > DIFS > EIFS

时间轴：
帧结束
   │
   ├─SIFS─┤ ACK/CTS可以发送
   │
   ├──PIFS──┤ PCF可以发送
   │
   ├───DIFS───┤ 普通数据可以发送
```

---

### 四、RTS/CTS握手机制（15分钟）★★

#### 4.1 基本原理

**内容要点**：
- RTS = Request To Send（请求发送）
- CTS = Clear To Send（清除发送/允许发送）
- 通过预约信道来避免冲突

#### 4.2 完整流程

**内容要点**：
```
时序图：

发送方A:  |--RTS--|              |-------DATA-------|
                   ↘
接收方B:           |--CTS--|                        |--ACK--|
                         ↘
隐蔽站C:     [收到RTS]  [收到CTS]  [NAV：保持静默...]

详细步骤：
1. A想发送数据给B
2. A先发送RTS帧，包含：源地址、目的地址、传输时长
3. B收到RTS后，回复CTS帧
4. A收到CTS后，发送DATA帧
5. B收到DATA后，回复ACK帧
```

#### 4.3 如何解决隐蔽站问题

**内容要点**：
```
场景：A发送给B，C是隐蔽站

    [A]──────►[B]◄──────[C]
      RTS→      ←CTS

解决过程：
1. A发送RTS → B收到
2. B回复CTS → C也能收到CTS！
3. C虽然听不到A，但能听到B的CTS
4. C知道有人要占用信道，设置NAV等待
5. 冲突避免！
```

#### 4.4 NAV机制

**内容要点**：
- NAV = Network Allocation Vector，网络分配向量
- 虚拟载波侦听
- 节点收到RTS/CTS后，从中读取传输时长
- 设置NAV计时器，在此期间认为信道忙

```
NAV机制示意：

      |--RTS--|--CTS--|----DATA----|--ACK--|
                  ↓
其他节点：  [────────── NAV ──────────]
              不侦听信道，保持静默
```

---

### 五、二进制指数退避算法（10分钟）

#### 5.1 基本原理

**内容要点**：
- 信道空闲时不立即发送，随机等待
- 碰撞后，退避窗口指数增长
- 减少再次碰撞的概率

#### 5.2 算法步骤

**内容要点**：
```
1. 初始竞争窗口：CW = CWmin（如15）
2. 随机选择退避时间：backoff = rand(0, CW) × 时隙时间
3. 等待退避时间后发送
4. 若发生碰撞：CW = min(2 × CW, CWmax)
5. 若发送成功：CW = CWmin

示例（CWmin=15, CWmax=1023）：
- 初始：CW=15，退避时间在0-15时隙之间随机
- 第1次碰撞：CW=31
- 第2次碰撞：CW=63
- 第3次碰撞：CW=127
- ...
- 最大：CW=1023
```

#### 5.3 为什么要指数增长？

**内容要点**：
- 碰撞说明竞争激烈
- 增大退避窗口，分散重传时间
- 减少再次碰撞的概率

---

### 六、本课时小结（5分钟）

#### 知识点回顾
1. CSMA/CA：碰撞避免，用于无线网络
2. 帧间间隔：SIFS < PIFS < DIFS，优先级控制
3. RTS/CTS机制：预约信道，解决隐蔽站问题 ★
4. NAV：虚拟载波侦听，避免不必要的侦听
5. 二进制指数退避：碰撞后窗口翻倍

#### 衔接语
> "CSMA/CA解决了无线网络的信道访问问题，但它是为WiFi设计的，功耗较高。WSN需要更省电的MAC协议，这就是下节课要学习的S-MAC、T-MAC等。"

---

# 第三节课（100分钟）：WSN专用MAC协议与总结

---

## 第5课时：2.3.5 WSN专用MAC协议（50分钟）

### 一、WSN对MAC的特殊需求（5分钟）

#### 1.1 回顾WSN特点

**内容要点**：
- 能量受限：电池供电，难以更换
- 通信特点：低数据率、事件驱动
- 网络特点：节点密集、多跳传输

#### 1.2 传统MAC的问题

**内容要点**：
- 空闲侦听：信道没有数据也要持续侦听，浪费能量
- 碰撞重传：浪费能量
- 串扰：收到不是给自己的数据，浪费能量
- 控制开销：RTS/CTS等控制帧消耗能量

**引出问题**：
> "如何设计一个更省电的MAC协议？核心思想是——不需要的时候就睡觉！"

---

### 二、S-MAC协议（15分钟）★★

#### 2.1 设计动机

**内容要点**：
- 减少空闲侦听
- 核心思想：周期性睡眠

#### 2.2 周期性睡眠机制

**内容要点**：
```
S-MAC工作周期：

|<─────────────── 一个周期 ───────────────>|
|<── 活跃期 ──>|<────── 睡眠期 ──────>|
| 监听 | 发送  |          休眠         |

占空比 = 活跃期 / 周期 = 5% ~ 20%

示例：
- 周期 = 1秒
- 占空比 = 10%
- 活跃期 = 100ms
- 睡眠期 = 900ms
- 节省90%的侦听能量！
```

#### 2.3 同步机制

**内容要点**：
- 邻居节点需要同步：同时醒来才能通信
- 使用SYNC帧进行同步
- 新加入节点跟随已有调度

```
节点同步：

节点A: |活跃|---睡眠---|活跃|---睡眠---|
节点B: |活跃|---睡眠---|活跃|---睡眠---|
         ↑               ↑
       同步醒来         同步醒来
```

#### 2.4 消息传递

**内容要点**：
- 长消息分片传输
- 突发传输模式：一次活跃期传输多个分片
- 避免每个分片都等一个周期

#### 2.5 S-MAC优缺点

**内容要点**：

| 优点 | 缺点 |
|------|------|
| 大幅降低空闲侦听能耗 | 延迟增加（要等活跃期） |
| 实现简单 | 固定占空比，不够灵活 |
| 节点自组织同步 | 边界节点需维护多个调度 |

---

### 三、T-MAC协议（12分钟）★★

#### 3.1 设计动机

**内容要点**：
- S-MAC问题：固定活跃期
- 流量低时：活跃期大部分时间空闲，浪费能量
- 流量高时：活跃期可能不够用

#### 3.2 自适应活跃期

**内容要点**：
```
S-MAC vs T-MAC：

S-MAC: |───固定活跃期───|─────睡眠期─────|
       |  有用 | 空闲浪费|

T-MAC: |─自适应活跃期─|───更长的睡眠期───|
       |  有用 |
                ↑
           超时后提前睡眠
```

#### 3.3 超时机制

**内容要点**：
- 定义超时时间TA
- 如果TA时间内没有活动（无数据收发），提前进入睡眠
- TA的选择：至少能完成一次RTS/CTS交换

```
T-MAC超时机制：

|活跃|←TA→|←TA→|←TA→| 超时！→ 睡眠
     ↓    ↓    ↓
    RTS   CTS  DATA    ← 有活动则重置TA
```

#### 3.4 早睡问题

**内容要点**：
```
问题场景：
- A发送给B，B转发给C
- A发完后B处理，C可能在等待时超时睡眠

解决方法：
- FRTS（Future RTS）：提前通知下一跳
- DS（更多数据）位：表示还有后续数据
```

#### 3.5 T-MAC优缺点

**内容要点**：

| 优点 | 缺点 |
|------|------|
| 自适应活跃期，更节能 | 实现较复杂 |
| 适应流量变化 | 早睡问题需要额外机制 |
| 兼容S-MAC | 同步开销与S-MAC相同 |

---

### 四、Z-MAC协议（8分钟）

#### 4.1 设计思想

**内容要点**：
- 结合TDMA（无冲突）和CSMA（灵活性）
- 低竞争时：类似CSMA
- 高竞争时：类似TDMA

#### 4.2 双模式工作

**内容要点**：
```
Z-MAC双模式：

低竞争级别（LCL）：
- 任何节点可在任何时隙尝试发送
- 时隙"拥有者"有优先权
- 竞争后发送

高竞争级别（HCL）：
- 只有时隙拥有者可在该时隙发送
- 避免冲突
```

#### 4.3 Z-MAC特点

**内容要点**：

| 特点 | 说明 |
|------|------|
| 自适应 | 根据竞争程度切换模式 |
| 高效 | 低负载时像CSMA灵活，高负载时像TDMA无冲突 |
| 复杂 | 需要时隙分配、模式切换机制 |

---

### 五、其他WSN MAC协议简介（5分钟）

#### 5.1 SIFT协议

**内容要点**：
- 用于事件驱动型WSN
- 固定竞争窗口
- 根据竞争节点数调整发送概率
- 适合多个节点同时检测到事件的场景

#### 5.2 TRAMA协议

**内容要点**：
- 流量自适应的TDMA
- 根据流量动态分配时隙
- 无冲突，适合稳定流量

---

### 六、本课时小结（5分钟）

#### 知识点回顾
1. WSN MAC面临的能量挑战
2. S-MAC：周期性睡眠，占空比5%-20% ★
3. T-MAC：自适应活跃期，超时提前睡眠 ★
4. Z-MAC：TDMA+CSMA混合，自适应切换
5. 不同协议适用不同场景

---

## 第6课时：2.3.6 总结与协议对比（50分钟）

### 一、MAC协议分类总结（10分钟）

#### 1.1 分类框架

**内容要点**：
```
MAC协议
├── 传统MAC
│   ├── 有线：CSMA/CD（以太网）
│   └── 无线：CSMA/CA（WiFi）
│
└── WSN专用MAC
    ├── 基于竞争
    │   ├── S-MAC（周期性睡眠）
    │   ├── T-MAC（自适应睡眠）
    │   └── SIFT（概率发送）
    ├── 基于调度
    │   ├── TDMA
    │   ├── TRAMA（流量自适应TDMA）
    │   └── SMACS/EAR
    └── 混合型
        └── Z-MAC（TDMA+CSMA）
```

#### 1.2 从CSMA/CD到WSN MAC的演进

**内容要点**：
```
CSMA/CD（有线）
    ↓ 无法检测碰撞
CSMA/CA（无线WiFi）
    ↓ 能耗太高
S-MAC（WSN）
    ↓ 固定占空比不灵活
T-MAC（WSN）
    ↓ 还可以更高效
Z-MAC（WSN）
```

---

### 二、协议性能对比（10分钟）

#### 2.1 性能对比表

**内容要点**：

| 协议 | 能效 | 延迟 | 吞吐量 | 复杂度 | 适用场景 |
|------|------|------|--------|--------|----------|
| CSMA/CA | 低 | 低 | 高 | 中 | WiFi |
| S-MAC | 高 | 高 | 低 | 低 | 低流量WSN |
| T-MAC | 高 | 中 | 中 | 中 | 变化流量 |
| Z-MAC | 中 | 低 | 高 | 高 | 高流量 |
| TDMA | 高 | 固定 | 固定 | 低 | 规则流量 |

#### 2.2 如何选择MAC协议？

**内容要点**：

| 应用场景 | 推荐协议 | 原因 |
|----------|----------|------|
| 环境监测（低流量） | S-MAC | 简单、省电 |
| 工业监控（变化流量） | T-MAC | 自适应 |
| 事件检测（突发流量） | Z-MAC | 高吞吐量 |
| 周期采集（规则流量） | TDMA | 无冲突 |
| 实时监控（低延迟） | CSMA/CA | 延迟低 |

---

### 三、重点知识回顾（10分钟）

#### 3.1 本章核心问题

**内容要点**：
```
问题1：多个节点如何共享信道？
答案：MAC协议

问题2：CSMA/CD为什么不适合无线？
答案：无法检测碰撞、隐蔽站、暴露站问题

问题3：CSMA/CA如何避免碰撞？
答案：RTS/CTS预约、NAV虚拟侦听

问题4：WSN MAC如何省电？
答案：周期性睡眠（S-MAC）、自适应睡眠（T-MAC）
```

#### 3.2 必须掌握的概念

**内容要点**：
1. **隐蔽站问题**：听不到不代表没有发送
2. **暴露站问题**：听得到不代表会干扰
3. **RTS/CTS**：预约信道，解决隐蔽站
4. **NAV**：虚拟载波侦听
5. **占空比**：活跃期/周期，S-MAC约5%-20%
6. **超时机制**：T-MAC的自适应关键

---

### 四、知识框架总结（5分钟）

**内容要点**：
```
2.3 MAC层技术介绍

├── 2.3.1 数据链路层概述
│   ├── 五大功能
│   ├── 帧结构与MAC地址
│   └── IEEE 802模型

├── 2.3.2 MAC协议分类
│   ├── 静态vs动态
│   ├── TDMA/FDMA/CDMA
│   └── ALOHA发展历史

├── 2.3.3 CSMA/CD
│   ├── 先听后发、边听边发、碰撞停止
│   ├── 隐蔽站问题 ★
│   └── 暴露站问题 ★

├── 2.3.4 CSMA/CA
│   ├── 帧间间隔（SIFS/DIFS）
│   ├── RTS/CTS机制 ★
│   ├── NAV虚拟侦听
│   └── 二进制指数退避

├── 2.3.5 WSN专用MAC
│   ├── S-MAC：周期性睡眠 ★
│   ├── T-MAC：自适应活跃期 ★
│   └── Z-MAC：混合调度

└── 2.3.6 总结与对比
    └── 协议选择指南
```

---

### 五、随堂练习（10分钟）

（见单独的练习题文档）

---

### 六、衔接下一章（5分钟）

#### 知识衔接

**内容要点**：
> "这一章我们学习了数据链路层，解决了'如何在多个节点间公平高效地共享信道'的问题。
>
> 下一章我们将学习网络层，解决'如何将数据从源节点路由到目的节点'的问题。
>
> 物理层负责传输比特，数据链路层负责传输帧，网络层负责传输数据包——它们层层配合，共同完成通信任务。"

#### 预习建议
- 回顾图论基础（最短路径）
- 了解WSN路由的特殊挑战
