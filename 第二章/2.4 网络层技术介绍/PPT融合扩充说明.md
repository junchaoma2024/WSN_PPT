# 第二章 2.4 网络层技术介绍 - PPT融合扩充说明

## 一、源文件概述

### 1.1 网络层协议_v1.pptx（54页）
- **定位**：基础版，深入讲解核心路由协议
- **覆盖协议**：Flooding、Gossiping、SPIN、LEACH
- **特点**：包含传统路由原理（路由表、距离向量），便于从传统网络过渡到WSN

### 1.2 网络层协议_v2.pptx（96页）
- **定位**：系统版，覆盖9种路由协议
- **覆盖协议**：Flooding、Gossiping、SPIN、DD（定向扩散）、LEACH、HEED、TTDD、PEGASIS、GEAR、GPSR、SPEED、SAR等
- **特点**：分类清晰（平面/层次/地理位置/QoS），配合清华大学教材

---

## 二、融合策略

### 2.1 总体原则
- **以v1为主体框架**：其传统路由→WSN路由的过渡讲解更清晰
- **融入v2的扩展协议**：DD、HEED、PEGASIS、GEAR等
- **4课时（200分钟）**：聚焦核心协议，扩展协议简要介绍

### 2.2 融合后预计页数
- 融合后约 **60-70页**
- 支撑 **4课时（200分钟）** 教学

---

## 三、详细融合方案

### 第一部分：2.4.1 网络层概述与路由基础（约15页）

#### 保留v1内容：
| 原页码 | 内容 | 处理方式 |
|--------|------|----------|
| 1 | 标题页 | 保留，更新目录 |
| 5-10 | 网络层定义、路由表原理 | 保留 |
| 11-20 | 传统路由算法（距离向量） | 精简保留核心概念 |

#### 融入v2内容：
| v2页码 | 内容 | 融合位置 |
|--------|------|----------|
| 3-10 | 路由协议概述、WSN路由挑战 | 插入概述部分 |
| 11-20 | 路由协议分类体系 | 补充分类框架 |

#### 扩充建议：
1. **新增"WSN路由vs传统路由对比"页面**
   ```
   | 特性 | 传统网络路由 | WSN路由 |
   |------|------------|---------|
   | 目标 | 最短路径/最低延迟 | 最低能耗/网络寿命 |
   | 地址 | IP地址唯一标识 | 以数据为中心 |
   | 节点 | 资源丰富 | 资源受限 |
   | 拓扑 | 相对稳定 | 动态变化 |
   | 数据流 | 点对点 | 多对一（汇聚） |
   ```

2. **新增"WSN路由面临的挑战"页面**
   - 能量受限：节点电池有限
   - 拓扑动态：节点可能失效
   - 数据冗余：相邻节点数据相似
   - 可扩展性：节点数量大
   - 以数据为中心：不关心谁发的，关心数据内容

3. **新增"路由协议分类总览"页面**
   ```
   WSN路由协议
   ├── 平面路由（Flat Routing）
   │   ├── Flooding（泛洪）
   │   ├── Gossiping（闲聊）
   │   ├── SPIN（自适应信息传播）
   │   └── DD（定向扩散）
   ├── 层次路由（Hierarchical Routing）
   │   ├── LEACH
   │   ├── HEED
   │   └── PEGASIS
   └── 地理位置路由（Geographic Routing）
       ├── GEAR
       └── GPSR
   ```

---

### 第二部分：2.4.2 平面路由协议（约18页）

#### 保留v1内容：
| 原页码 | 内容 | 处理方式 |
|--------|------|----------|
| 35-36 | Flooding原理与问题 | 保留，扩充 |
| 36-37 | Gossiping原理 | 保留，扩充 |
| 38-42 | SPIN三次握手（ADV-REQ-DATA） | 保留，重点讲解 |

#### 融入v2内容：
| v2页码 | 内容 | 融合位置 |
|--------|------|----------|
| 31-33 | Flooding和Gossiping详细分析 | 补充到对应部分 |
| 34-37 | SPIN详细机制 | 补充SPIN部分 |
| 38-41 | **DD（定向扩散）协议** | 新增DD部分 ★ |

#### 扩充建议：

##### Flooding扩充（3页）
1. **完整工作流程图**
   ```
   源节点S发送数据：
   S → 所有邻居 → 各邻居再转发给所有邻居 → ...

   问题：
   - 信息爆炸（implosion）：同一数据被多次接收
   - 数据重叠（overlap）：相邻节点监测相同区域
   - 资源浪费（resource blindness）：不考虑节点能量
   ```

##### Gossiping扩充（2页）
1. **与Flooding对比**
   ```
   Flooding: S → 所有邻居（广播）
   Gossiping: S → 随机一个邻居（单播）

   优点：减少信息爆炸
   缺点：传播速度慢，可能遗漏节点
   ```

##### SPIN扩充（5页）
1. **三种消息类型详解**
   ```
   ADV（广告）：我有新数据，要不要？
   REQ（请求）：要，发给我！
   DATA（数据）：给你，数据来了！

   三次握手流程：
   节点A: ──ADV──→ 节点B
   节点A: ←──REQ── 节点B
   节点A: ──DATA─→ 节点B
   ```

2. **SPIN vs Flooding对比**
   ```
   | 特性 | Flooding | SPIN |
   |------|----------|------|
   | 转发策略 | 盲目广播 | 协商后转发 |
   | 冗余 | 大量冗余 | 减少冗余 |
   | 能量感知 | 无 | 有（能量阈值） |
   | 可靠性 | 高（全覆盖） | 中（可能遗漏） |
   ```

##### DD（定向扩散）新增（5页）★
1. **DD概述**
   - 以数据为中心的路由协议
   - Sink节点发布兴趣（Interest），源节点沿梯度（Gradient）回传数据

2. **DD三阶段**
   ```
   阶段一：兴趣扩散（Interest Propagation）
   Sink → 广播兴趣消息 → 建立梯度

   阶段二：数据传播（Data Propagation）
   源节点 → 沿梯度回传数据 → 多条路径

   阶段三：路径加强（Reinforcement）
   Sink → 选择最优路径 → 加强该路径，抑制其他路径
   ```

3. **DD特点**
   - 以数据命名（不用地址）
   - 多路径探索，选择最优
   - 能量高效

---

### 第三部分：2.4.3 层次路由协议（约20页）

#### 保留v1内容：
| 原页码 | 内容 | 处理方式 |
|--------|------|----------|
| 43-44 | LEACH基本原理 | 保留，重点扩充 |
| 45-48 | LEACH簇头选举与数据融合 | 保留，详细讲解 |

#### 融入v2内容：
| v2页码 | 内容 | 融合位置 |
|--------|------|----------|
| 47-52 | LEACH详细分析 | 补充LEACH |
| 53-54 | **HEED协议** | 新增 |
| 59-62 | **TTDD协议** | 可选简介 |
| 65-66 | **PEGASIS协议** | 新增 |

#### 扩充建议：

##### LEACH重点扩充（10页）★★
1. **分簇思想**
   ```
   为什么要分簇？
   - 减少通信距离（簇内短距离通信）
   - 数据融合（簇头汇总数据）
   - 负载均衡（轮换簇头）

   网络结构：
   ┌──────────────────────────────────┐
   │            基站（BS）              │
   │               ↑                   │
   │    ┌────┐  ┌────┐  ┌────┐       │
   │    │簇头1│  │簇头2│  │簇头3│       │
   │    │ ↑↑ │  │ ↑↑ │  │ ↑↑ │       │
   │    │成员 │  │成员 │  │成员 │       │
   │    └────┘  └────┘  └────┘       │
   └──────────────────────────────────┘
   ```

2. **LEACH两个阶段**
   ```
   阶段一：建立阶段（Setup Phase）
   - 簇头选举：每个节点生成随机数，小于阈值T(n)则成为簇头
   - T(n) = p / (1 - p × (r mod 1/p))
   - p：期望簇头比例（如5%）
   - r：当前轮数
   - 非簇头节点选择最近的簇头加入

   阶段二：稳定阶段（Steady Phase）
   - 簇内通信：成员按TDMA时隙向簇头发送数据
   - 数据融合：簇头汇总压缩簇内数据
   - 簇间通信：簇头直接向基站发送融合后数据
   ```

3. **LEACH能量优势**
   ```
   普通多跳：每个节点 → 多跳 → 基站
   LEACH：成员 → 簇头（短距离）→ 基站（长距离）

   节省能量的原因：
   - 簇内短距离通信能耗低
   - 数据融合减少传输量
   - 簇头轮换避免单点能量耗尽
   ```

##### HEED简介（2页）
1. **HEED vs LEACH**
   ```
   | 特性 | LEACH | HEED |
   |------|-------|------|
   | 簇头选择 | 随机 | 考虑剩余能量 |
   | 分布式 | 是 | 是 |
   | 能量均衡 | 一般 | 更好 |
   ```

##### PEGASIS简介（2页）
1. **链式结构**
   ```
   LEACH: 成员 → 簇头 → 基站（星型）
   PEGASIS: 节点 → 节点 → ... → 链头 → 基站（链式）

   特点：
   - 每个节点只与最近邻居通信
   - 减少能耗
   - 链头轮换
   ```

---

### 第四部分：2.4.4 地理位置路由与总结（约12页）

#### 融入v2内容：
| v2页码 | 内容 | 融合位置 |
|--------|------|----------|
| 77-78 | GEAR协议 | 新增简介 |
| 79-80 | GPSR协议 | 新增简介 |

#### 扩充建议：

##### 地理位置路由简介（4页）
1. **基本思想**：利用节点的地理位置信息做路由决策
2. **GEAR**：地理和能量感知路由
3. **GPSR**：贪婪转发 + 周边转发

##### 协议综合对比与总结（6页）
1. **全部协议对比表**
   ```
   | 协议 | 类型 | 能效 | 延迟 | 可扩展性 | 适用场景 |
   |------|------|------|------|----------|----------|
   | Flooding | 平面 | 低 | 低 | 差 | 小网络 |
   | Gossiping | 平面 | 中 | 高 | 差 | 小网络 |
   | SPIN | 平面 | 中 | 中 | 中 | 数据驱动 |
   | DD | 平面 | 高 | 中 | 中 | 查询驱动 |
   | LEACH | 层次 | 高 | 中 | 好 | 周期采集 |
   | PEGASIS | 层次 | 高 | 高 | 中 | 链式网络 |
   | GEAR | 地理 | 高 | 低 | 好 | 有位置信息 |
   ```

2. **知识框架图**
3. **衔接下一章**

---

## 四、融合后完整目录

```
2.4 网络层技术介绍（约65页）

第一节课（100分钟）
├── 2.4.1 网络层概述与路由基础（15页，40分钟）
│   ├── 网络层在WSN中的作用
│   ├── 传统路由 vs WSN路由
│   ├── WSN路由面临的挑战
│   ├── 路由协议分类
│   └── 路由表基本原理
│
└── 2.4.2 平面路由协议（18页，60分钟）
    ├── Flooding（泛洪）★
    ├── Gossiping（闲聊）★
    ├── SPIN（三次握手）★★
    └── DD（定向扩散）★

第二节课（100分钟）
├── 2.4.3 层次路由协议（20页，70分钟）
│   ├── 分簇思想
│   ├── LEACH协议 ★★（重点）
│   │   ├── 簇头选举
│   │   ├── 数据融合
│   │   └── 两阶段工作过程
│   ├── HEED（简介）
│   └── PEGASIS（简介）
│
└── 2.4.4 其他路由与总结（12页，30分钟）
    ├── 地理位置路由（GEAR/GPSR简介）
    ├── 协议对比总结表
    ├── 协议选择指南
    └── 衔接下一章

注：★★ 重点内容  ★ 次重点
```

---

## 五、教学资源建议

### 5.1 动画演示
- Flooding泛洪扩散过程
- SPIN三次握手交互
- DD兴趣扩散与梯度建立
- LEACH分簇与簇头轮换

### 5.2 案例分析
- 森林火灾监测中的路由选择
- 智能农业中的数据汇聚
- 工厂监控中的实时路由需求
