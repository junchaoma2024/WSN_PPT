# 第二章 2.4 网络层技术介绍 - 备课笔记（提纲版）

## 课程信息

| 项目 | 内容 |
|------|------|
| 章节 | 2.4 网络层技术介绍 |
| 总课时 | 4课时（200分钟） |
| 课次安排 | 2次课，每次100分钟 |
| 前导知识 | 2.3节 MAC层技术（CSMA/CD、CSMA/CA、S-MAC等） |
| 教学目标 | 理解WSN路由协议的设计思想、分类体系和核心协议工作原理 |
| 参考PPT | 网络层协议_v1.pptx（54页）、网络层协议_v2.pptx（96页） |
| 融合后页数 | 约65页 |

---

## 教学目标

### 知识目标
1. 理解网络层在WSN协议栈中的作用与位置
2. 掌握传统路由与WSN路由的本质区别
3. 掌握WSN路由协议的分类体系（平面/层次/地理位置）
4. 深入理解核心协议：Flooding、Gossiping、SPIN、DD、LEACH
5. 了解扩展协议：HEED、PEGASIS、GEAR

### 能力目标
1. 能根据应用场景选择合适的路由协议
2. 能分析各协议的优缺点及适用条件
3. 能理解以数据为中心的路由设计思想

### 情感目标
1. 体会WSN路由设计中能量约束带来的挑战
2. 激发对路由优化问题的研究兴趣

---

## 第一次课（第1-2课时，100分钟）

### 2.4.1 网络层概述与路由基础（40分钟）

#### 一、网络层在WSN中的作用（10分钟）
- **教学重点**：网络层的功能定位
- **内容要点**：
  1. 回顾OSI七层模型，定位网络层
  2. 网络层核心功能：路由选择、数据转发、拥塞控制
  3. WSN中网络层的特殊性
     - 以数据为中心（data-centric），不同于传统网络以地址为中心
     - 能量是首要考虑因素
     - 拓扑频繁变化

- **衔接设计**：
  > "上节课我们学习了MAC层，解决了'如何在共享信道上有序通信'的问题。现在数据帧已经可以在相邻节点间传输了，但如果源节点和目标节点不相邻怎么办？这就是网络层要解决的问题——路由。"

#### 二、传统路由基础回顾（15分钟）
- **教学重点**：路由表、距离向量算法（概念层面）
- **内容要点**：
  1. 路由的基本概念
     - 路由（Routing）：选择从源到目的的路径
     - 路由表（Routing Table）：存储路径信息的数据结构
     - 路由表项：目的地址、下一跳、跳数/代价
  2. 传统路由算法简介
     - 距离向量算法（DV）：每个节点维护到所有目的地的距离
     - 链路状态算法（LS）：每个节点掌握全网拓扑
  3. 传统路由的假设
     - 节点资源充足（计算、存储、能量）
     - 拓扑相对稳定
     - 以地址为标识（IP地址）
     - 端到端通信模式

- **板书/PPT提示**：
  ```
  路由表示例：
  | 目的地 | 下一跳 | 跳数 |
  |--------|--------|------|
  | A      | B      | 2    |
  | C      | D      | 3    |
  ```

#### 三、WSN路由的特殊挑战（10分钟）
- **教学重点**：理解为什么传统路由不适用于WSN ★
- **内容要点**：
  1. **能量受限**
     - 节点电池供电，能量有限且通常不可充电
     - 路由设计必须以最小化能耗为首要目标
  2. **拓扑动态变化**
     - 节点失效（能量耗尽、物理损坏）
     - 新节点加入
     - 环境干扰导致链路变化
  3. **数据冗余**
     - 密集部署的相邻节点采集相似数据
     - 需要数据融合（Data Aggregation）减少传输量
  4. **以数据为中心**
     - 不关心"谁发的"，关心"发了什么"
     - 查询驱动：Sink节点发布感兴趣的数据类型
  5. **可扩展性**
     - 节点数量可达数百至数千
     - 需要分布式、自组织的路由方案

- **对比表格（重点PPT页面）**：
  ```
  | 特性     | 传统网络路由      | WSN路由          |
  |----------|------------------|------------------|
  | 优化目标 | 最短路径/最低延迟  | 最低能耗/最长寿命 |
  | 寻址方式 | IP地址唯一标识     | 以数据为中心      |
  | 节点资源 | 资源丰富          | 资源受限          |
  | 网络拓扑 | 相对稳定          | 动态变化          |
  | 数据模式 | 点对点            | 多对一（汇聚）    |
  ```

- **互动设计**：
  > 提问："传统Internet路由追求最短路径，但WSN中如果总走最短路径会怎样？"
  > 引导学生思考：最短路径上的节点能量快速耗尽 → 网络分割

#### 四、路由协议分类体系（5分钟）
- **教学重点**：建立协议分类框架
- **内容要点**：
  1. **按网络结构分类**
     - 平面路由（Flat Routing）：所有节点地位平等
       - Flooding、Gossiping、SPIN、DD
     - 层次路由（Hierarchical Routing）：分簇/分层结构
       - LEACH、HEED、PEGASIS
     - 地理位置路由（Geographic Routing）：利用位置信息
       - GEAR、GPSR
  2. **按路由发现方式分类**
     - 主动式（Proactive）：预先建立路由
     - 反应式（Reactive）：按需建立路由
     - 混合式（Hybrid）
  3. **按数据传递模式分类**
     - 数据驱动（Data-driven）
     - 查询驱动（Query-driven）
     - 事件驱动（Event-driven）

- **PPT提示**：展示路由协议分类树状图

---

### 2.4.2 平面路由协议（60分钟）

#### 一、Flooding（泛洪协议）（10分钟）★
- **教学重点**：理解最简单的路由方式及其问题
- **内容要点**：
  1. **基本原理**
     - 源节点将数据包广播给所有邻居
     - 每个收到数据的节点再广播给自己的所有邻居
     - 不需要路由表，不需要知道网络拓扑
  2. **工作流程**
     ```
     源节点S发送数据包P：
     S → 广播给邻居{A, B, C}
     A → 广播给邻居{S, D, E}（排除S可选）
     B → 广播给邻居{S, E, F}
     C → 广播给邻居{S, G}
     ... 数据包"洪水般"扩散到全网
     ```
  3. **三大问题**
     - **信息爆炸（Implosion）**：同一个数据包被节点多次接收
       - 例：A同时从B和C收到同一份数据
     - **数据重叠（Overlap）**：相邻节点监测重叠区域，发送冗余数据
     - **资源盲目（Resource Blindness）**：不考虑节点剩余能量
  4. **优缺点**
     - 优点：简单、可靠（只要存在路径就能到达）、不需要维护路由信息
     - 缺点：能耗极高、大量冗余、不可扩展

- **互动设计**：
  > "想象一下，你在一个大礼堂里想把消息传给最后一排的同学，你大喊一声，每个听到的人再大喊一遍——这就是Flooding。问题是什么？"

- **板书提示**：画出5-6个节点的泛洪过程示意图

#### 二、Gossiping（闲聊协议）（8分钟）★
- **教学重点**：理解Gossiping对Flooding的改进
- **内容要点**：
  1. **基本原理**
     - 与Flooding类似，但每个节点不是广播给所有邻居
     - 而是随机选择一个邻居进行转发
  2. **与Flooding对比**
     ```
     Flooding:  S → {A, B, C}（广播给所有邻居）
     Gossiping: S → B（随机选一个邻居）
     ```
  3. **优缺点**
     - 优点：大幅减少信息爆炸，降低网络负载
     - 缺点：
       - 传播速度慢（每次只传一个邻居）
       - 可能遗漏部分节点（随机性导致覆盖不全）
       - 延迟增大
  4. **适用场景**
     - 对实时性要求不高的场景
     - 小规模网络

- **过渡语**：
  > "Flooding太浪费，Gossiping太慢，有没有一种协议能在效率和可靠性之间取得平衡？这就是SPIN协议。"

#### 三、SPIN（自适应信息传播协议）（20分钟）★★
- **教学重点**：SPIN的三次握手机制 ★★（重点）
- **内容要点**：
  1. **设计思想**
     - 核心改进：先协商，再传数据
     - 用元数据（metadata）描述数据内容
     - 避免发送接收方已有的或不需要的数据
  2. **三种消息类型**
     - **ADV（Advertisement，广告）**：通知邻居"我有新数据"
       - 包含数据的元数据描述（不是数据本身）
     - **REQ（Request，请求）**：表示"我需要这个数据"
       - 收到ADV后，如果对该数据感兴趣且没有，发送REQ
     - **DATA（数据）**：实际的传感器数据
       - 收到REQ后，发送实际数据
  3. **三次握手流程（核心内容）**
     ```
     节点A有新数据 data_x：

     步骤1：A → ADV(data_x) → 邻居B, C, D
            "嘿，我有data_x的数据，你们要不要？"

     步骤2：B已有data_x，忽略；C, D没有
            C → REQ(data_x) → A
            D → REQ(data_x) → A
            "要，发给我！"

     步骤3：A → DATA(data_x) → C, D
            "给你们！"

     步骤4：C收到data_x后，再向自己的邻居发ADV
            传播继续...
     ```
  4. **能量感知机制**
     - 节点可以设置能量阈值
     - 当剩余能量低于阈值时，即使收到ADV也不发REQ
     - 避免能量耗尽
  5. **SPIN协议族**
     - SPIN-PP：点对点网络
     - SPIN-EC：增加能量阈值约束
     - SPIN-BC：广播网络
     - SPIN-RL：考虑链路可靠性
  6. **优缺点**
     - 优点：
       - 协商机制减少冗余传输
       - 支持能量感知
       - 元数据传输开销小
     - 缺点：
       - 不保证数据传递到所有感兴趣的节点
       - 如果中间节点对数据不感兴趣，数据传播中断
       - ADV-REQ-DATA三步开销

- **互动设计**：
  > 画出4个节点的SPIN传播过程，请学生判断哪些节点会收到数据

- **板书提示**：画出完整的三次握手时序图

#### 四、SPIN与Flooding对比总结（2分钟）
- **对比表格**：
  ```
  | 特性     | Flooding | Gossiping | SPIN       |
  |----------|----------|-----------|------------|
  | 转发策略 | 盲目广播  | 随机单播   | 协商后转发  |
  | 冗余程度 | 非常高   | 中等      | 较低        |
  | 能量感知 | 无       | 无        | 有          |
  | 可靠性   | 高       | 低        | 中          |
  | 延迟     | 低       | 高        | 中          |
  | 适用规模 | 小网络   | 小网络    | 中等网络    |
  ```

#### 五、DD（定向扩散协议）（18分钟）★
- **教学重点**：以数据为中心的查询驱动路由
- **内容要点**：
  1. **DD概述**
     - 全称：Directed Diffusion（定向扩散）
     - 由Intanagonwiwat等人于2000年提出
     - 以数据为中心的路由协议
     - 查询驱动：由Sink节点发起
     - 核心概念：兴趣（Interest）、梯度（Gradient）、加强（Reinforcement）
  2. **核心概念解释**
     - **兴趣（Interest）**：Sink节点对数据的需求描述
       - 例："报告温度>50度的区域，每5秒一次"
       - 包含：数据类型、时间间隔、地理区域、持续时间
     - **梯度（Gradient）**：从数据源到Sink的方向指示
       - 由兴趣消息扩散过程建立
       - 每个节点记录"兴趣来自哪个邻居"
     - **加强（Reinforcement）**：选择最优路径并加强
  3. **DD三阶段工作过程（核心内容）**
     ```
     阶段一：兴趣扩散（Interest Propagation）
     ─────────────────────────────────────
     Sink发布兴趣消息 → 广播扩散到全网
     每个中间节点记录：兴趣来自哪个邻居 → 建立梯度

     Sink ──兴趣──→ A ──兴趣──→ D（源节点）
     Sink ──兴趣──→ B ──兴趣──→ D
     Sink ──兴趣──→ C ──兴趣──→ D

     阶段二：数据传播（Data Propagation）
     ─────────────────────────────────────
     源节点D检测到匹配数据 → 沿梯度反向传回Sink
     可能有多条路径同时传输数据（探索性传输）

     D ──数据──→ A ──数据──→ Sink（路径1）
     D ──数据──→ B ──数据──→ Sink（路径2）
     D ──数据──→ C ──数据──→ Sink（路径3）

     阶段三：路径加强（Reinforcement）
     ─────────────────────────────────────
     Sink评估各路径质量（延迟、丢包率等）
     选择最优路径 → 加强该路径（提高数据传输频率）
     抑制其他路径（降低频率或停止）

     Sink选择路径1（最快）→ 加强A
     路径2、3被抑制
     ```
  4. **DD特点**
     - 以数据命名（不用IP地址）
     - 多路径探索，选择最优
     - 按需路由（Sink发起查询时才建立路由）
     - 支持数据融合（中间节点可以合并数据）
  5. **优缺点**
     - 优点：
       - 能量高效（只传输Sink关心的数据）
       - 支持数据融合
       - 多路径鲁棒性好
     - 缺点：
       - 兴趣扩散开销大（全网广播）
       - 不适合持续监测场景（需反复发布兴趣）
       - 梯度维护开销
  6. **DD vs SPIN对比**
     ```
     | 特性     | SPIN        | DD           |
     |----------|-------------|--------------|
     | 发起方   | 源节点      | Sink节点     |
     | 模式     | 数据驱动    | 查询驱动     |
     | 传播方式 | 逐跳协商    | 全网扩散+加强 |
     | 数据融合 | 不支持      | 支持         |
     ```

- **互动设计**：
  > "假设你是森林防火监控站（Sink），你想知道哪里温度超过60度。你会怎么发布这个需求？节点们又该怎么响应？"

#### 六、平面路由协议小结（2分钟）
- 四种协议的演进逻辑：
  ```
  Flooding（盲目广播）
    ↓ 改进：减少广播量
  Gossiping（随机单播）
    ↓ 改进：先协商再传输
  SPIN（协商机制）
    ↓ 改进：以数据为中心，查询驱动
  DD（定向扩散）
  ```
- 预告下节课内容：层次路由

---

## 第二次课（第3-4课时，100分钟）

### 2.4.3 层次路由协议（70分钟）

#### 一、分簇思想引入（8分钟）
- **教学重点**：为什么需要层次结构
- **内容要点**：
  1. **平面路由的局限**
     - 所有节点地位平等，每个节点都参与路由
     - 大规模网络中路由维护开销大
     - 缺乏有效的数据融合机制
  2. **分簇思想**
     - 将网络划分为多个簇（Cluster）
     - 每个簇选举一个簇头（Cluster Head, CH）
     - 簇内成员（Member）→ 簇头 → 基站（BS）
     - 两级通信：簇内短距离 + 簇间长距离
  3. **分簇的优势**
     - 减少通信距离：簇内通信距离短
     - 数据融合：簇头汇总压缩簇内数据
     - 可扩展性：簇结构便于管理大规模网络
     - 负载均衡：通过簇头轮换分担能量消耗
  4. **层次结构示意**
     ```
     ┌──────────────────────────────────┐
     │            基站（BS）              │
     │           ↗    ↑    ↖            │
     │    ┌────┐  ┌────┐  ┌────┐       │
     │    │CH-1│  │CH-2│  │CH-3│       │
     │    │↗↑↖│  │↗↑↖│  │↗↑↖│       │
     │    │成员 │  │成员 │  │成员 │       │
     │    └────┘  └────┘  └────┘       │
     └──────────────────────────────────┘
     ```

- **过渡语**：
  > "平面路由中，每个节点都要参与全网路由，就像一个班级没有班长，所有事情大家一起商量，效率很低。分簇就像设立班长（簇头），平时由班长收集信息汇报给老师（基站），其他同学只需要跟班长沟通就行。"

#### 二、LEACH协议（35分钟）★★（重点）
- **教学重点**：LEACH的两阶段工作过程、簇头选举机制
- **内容要点**：
  1. **LEACH概述**
     - 全称：Low-Energy Adaptive Clustering Hierarchy
     - 低能耗自适应分簇层次协议
     - 由Heinzelman等人于2000年提出
     - WSN中最经典的分簇路由协议
     - 核心思想：轮换簇头，均衡能耗
  2. **LEACH两阶段工作过程**

     **阶段一：建立阶段（Setup Phase）**
     ```
     步骤1：簇头选举
     ─────────────
     每个节点生成一个0~1之间的随机数
     如果随机数 < 阈值T(n)，则该节点成为簇头

     阈值公式：T(n) = p / (1 - p × (r mod 1/p))
     其中：
     - p：期望的簇头比例（通常为5%）
     - r：当前轮数
     - n：本轮尚未当过簇头的节点

     注意：已经当过簇头的节点在本周期内T(n)=0，
     确保所有节点轮流当簇头

     步骤2：簇头广播
     ─────────────
     当选簇头 → 向全网广播"我是簇头"

     步骤3：成员加入
     ─────────────
     非簇头节点 → 选择信号最强（最近）的簇头 → 发送加入请求

     步骤4：时隙分配
     ─────────────
     簇头收到所有加入请求后 → 建立TDMA调度表 → 广播给簇成员
     ```

     **阶段二：稳定阶段（Steady Phase）**
     ```
     步骤5：簇内数据传输
     ─────────────────
     簇成员按TDMA时隙向簇头发送数据
     非自己时隙时进入睡眠（节能）

     步骤6：数据融合
     ─────────────
     簇头收集所有成员数据 → 数据融合/压缩
     例：10个成员各发1个温度值 → 簇头计算平均值
     原始数据量减少90%

     步骤7：簇头向基站传输
     ─────────────────
     簇头将融合后的数据直接发送给基站

     一轮结束后，重新执行建立阶段（簇头轮换）
     ```

  3. **簇头选举机制详解**
     - 阈值T(n)的含义：
       - p=5%时，平均每20个节点选出1个簇头
       - `r mod 1/p`：确保在1/p轮内所有节点都有机会当簇头
       - 已当过簇头的节点T(n)=0，本周期不再参选
     - 轮换机制的意义：
       - 避免固定簇头能量快速耗尽
       - 均衡全网能量消耗
       - 延长网络生存时间

  4. **LEACH能量分析**
     ```
     直接传输：每个节点 → 基站（长距离，能耗高）
     多跳传输：节点 → 节点 → ... → 基站（中间节点负担重）
     LEACH：   成员 → 簇头（短距离）→ 基站（只有簇头承担长距离）

     能量节省的三个原因：
     ① 簇内通信距离短 → 传输能耗低（能耗∝距离²或距离⁴）
     ② 数据融合 → 减少传输数据量
     ③ 簇头轮换 → 避免单点能量耗尽
     ```

  5. **LEACH的局限性**
     - 簇头选举随机，不考虑节点剩余能量
     - 簇头直接与基站通信，距离远时能耗大
     - 假设所有节点都能直接到达基站（不适用于大规模网络）
     - 簇的大小不均匀
     - 不适合节点移动的场景

- **互动设计**：
  > "假设有100个节点，p=5%，第一轮大约有多少个簇头？"（约5个）
  > "如果某个区域的5个节点都被选为簇头，会有什么问题？"（该区域簇头过多，其他区域没有簇头）

- **板书提示**：
  - 画出LEACH两阶段的时间轴
  - 画出分簇结构示意图
  - 写出阈值公式T(n)

#### 三、HEED协议简介（10分钟）
- **教学重点**：理解HEED对LEACH的改进
- **内容要点**：
  1. **HEED概述**
     - 全称：Hybrid Energy-Efficient Distributed Clustering
     - 混合能量高效分布式分簇协议
  2. **HEED vs LEACH**
     - LEACH：簇头随机选举 → 可能选到能量低的节点
     - HEED：簇头选举综合考虑两个参数
       - 主参数：节点剩余能量（能量多的优先）
       - 副参数：簇内通信代价（节点密度）
  3. **HEED优势**
     ```
     | 特性       | LEACH      | HEED         |
     |------------|------------|--------------|
     | 簇头选择   | 随机       | 基于剩余能量  |
     | 簇头分布   | 可能不均匀 | 更加均匀      |
     | 能量均衡   | 一般       | 更好          |
     | 终止性     | 确定       | O(1)轮内终止  |
     ```
  4. **局限性**
     - 簇头选举过程中通信开销较大
     - 仍采用单跳簇头到基站通信

#### 四、PEGASIS协议简介（10分钟）
- **教学重点**：链式结构的思想
- **内容要点**：
  1. **PEGASIS概述**
     - 全称：Power-Efficient GAthering in Sensor Information Systems
     - 能量高效的传感器信息收集系统
     - 对LEACH的改进：从星型结构 → 链式结构
  2. **核心思想**
     - 所有节点组成一条链（Chain）
     - 每个节点只与最近的邻居通信
     - 选择一个链头（Chain Leader）负责向基站传输
     - 链头轮换
  3. **工作过程**
     ```
     LEACH（星型）：
     成员1 ─→ ┐
     成员2 ─→ ├→ 簇头 ──→ 基站
     成员3 ─→ ┘

     PEGASIS（链式）：
     节点1 → 节点2 → 节点3 → ... → 链头 → 基站

     每个节点只需要与最近邻居通信
     数据在链上逐步融合
     ```
  4. **PEGASIS vs LEACH**
     ```
     | 特性       | LEACH      | PEGASIS    |
     |------------|------------|------------|
     | 结构       | 星型（簇）  | 链式       |
     | 通信距离   | 到簇头     | 到最近邻居  |
     | 数据融合   | 簇头融合   | 链上逐步融合|
     | 领导者     | 簇头       | 链头       |
     | 能耗       | 较低       | 更低       |
     ```
  5. **局限性**
     - 链的构建需要全局信息
     - 链头距离基站远时能耗大
     - 延迟较大（数据需要沿链传输）
     - 不适合动态拓扑

- **互动设计**：
  > "LEACH是班级模式（每组一个组长），PEGASIS是接力赛模式（一个接一个传递）。哪种情况下接力赛更高效？哪种情况下不适合？"

#### 五、层次路由协议小结（7分钟）
- **三种层次路由对比**：
  ```
  | 特性       | LEACH          | HEED           | PEGASIS      |
  |------------|----------------|----------------|--------------|
  | 结构       | 簇（星型）      | 簇（星型）      | 链式         |
  | 簇头/链头选择 | 随机          | 基于剩余能量   | 贪心算法     |
  | 数据融合   | 簇头融合        | 簇头融合        | 链上逐步融合  |
  | 能量均衡   | 一般           | 好             | 好           |
  | 延迟       | 中             | 中             | 高           |
  | 可扩展性   | 好             | 好             | 中           |
  ```
- 层次路由的核心优势：数据融合 + 减少传输距离

---

### 2.4.4 地理位置路由与总结（30分钟）

#### 一、地理位置路由简介（12分钟）
- **教学重点**：了解利用位置信息的路由思想
- **内容要点**：
  1. **基本思想**
     - 前提：节点知道自己的地理位置（GPS或定位算法）
     - 利用位置信息做路由决策
     - 不需要维护全局路由表
  2. **GEAR协议简介**
     - 全称：Geographic and Energy Aware Routing
     - 地理和能量感知路由
     - 结合地理位置和剩余能量选择下一跳
     - 两阶段：
       - 转发到目标区域（贪心 + 能量感知）
       - 在目标区域内扩散数据
  3. **GPSR协议简介**
     - 全称：Greedy Perimeter Stateless Routing
     - 贪心周边无状态路由
     - 两种模式：
       - **贪心模式（Greedy）**：选择距目标最近的邻居转发
       - **周边模式（Perimeter）**：遇到"空洞"时沿边界转发
     ```
     贪心模式：
     当前节点 → 选择离目标最近的邻居 → 继续转发

     空洞问题：
     没有比当前节点更靠近目标的邻居 → 切换到周边模式
     沿空洞边界转发，直到可以恢复贪心模式
     ```
  4. **地理位置路由的优缺点**
     - 优点：
       - 不需要全局路由信息
       - 可扩展性好
       - 局部决策，开销小
     - 缺点：
       - 需要节点定位能力（GPS成本、室内不适用）
       - 空洞问题处理复杂
       - 位置信息可能不精确

#### 二、协议综合对比（10分钟）
- **教学重点**：建立全局视角
- **全部协议对比表**：
  ```
  | 协议     | 类型   | 能效 | 延迟 | 可扩展性 | 数据融合 | 适用场景       |
  |----------|--------|------|------|----------|----------|---------------|
  | Flooding | 平面   | 低   | 低   | 差       | 无       | 极小网络/紧急  |
  | Gossiping| 平面   | 中   | 高   | 差       | 无       | 小网络         |
  | SPIN     | 平面   | 中   | 中   | 中       | 无       | 数据驱动场景   |
  | DD       | 平面   | 高   | 中   | 中       | 有       | 查询驱动场景   |
  | LEACH    | 层次   | 高   | 中   | 好       | 有       | 周期性数据采集 |
  | HEED     | 层次   | 高   | 中   | 好       | 有       | 能量敏感场景   |
  | PEGASIS  | 层次   | 高   | 高   | 中       | 有       | 链式数据收集   |
  | GEAR     | 地理   | 高   | 低   | 好       | 有       | 有位置信息     |
  | GPSR     | 地理   | 高   | 低   | 好       | 无       | 有位置信息     |
  ```

- **选择指南**：
  ```
  场景分析：
  ① 小规模、简单应用 → Flooding / Gossiping
  ② 数据驱动、需要协商 → SPIN
  ③ 查询驱动、需要融合 → DD
  ④ 大规模、周期采集 → LEACH / HEED
  ⑤ 节点有GPS → GEAR / GPSR
  ```

#### 三、知识框架总结（5分钟）
- **本节知识框架图**：
  ```
  2.4 网络层技术介绍
  ├── 2.4.1 概述与基础
  │   ├── 网络层功能
  │   ├── 传统路由 vs WSN路由
  │   ├── WSN路由挑战
  │   └── 协议分类体系
  ├── 2.4.2 平面路由
  │   ├── Flooding（泛洪）
  │   ├── Gossiping（闲聊）
  │   ├── SPIN（协商机制）★★
  │   └── DD（定向扩散）★
  ├── 2.4.3 层次路由
  │   ├── 分簇思想
  │   ├── LEACH ★★（核心）
  │   ├── HEED（能量改进）
  │   └── PEGASIS（链式结构）
  └── 2.4.4 地理位置路由与总结
      ├── GEAR / GPSR
      ├── 协议对比总结
      └── 选择指南

  ★★ 重点  ★ 次重点
  ```

#### 四、衔接下一章（3分钟）
- 回顾2.4节学到的内容
- 预告下一节内容
  > "我们学完了网络层，知道了数据如何从源节点路由到基站。但在传输过程中，数据的安全性、可靠性如何保障？下一节我们将进入传输层和应用层的学习。"

---

## 课时分配总览

### 第一次课（100分钟）

| 时间段 | 章节 | 内容 | 时长 |
|--------|------|------|------|
| 0-10 | 2.4.1 | 网络层在WSN中的作用 | 10分钟 |
| 10-25 | 2.4.1 | 传统路由基础回顾 | 15分钟 |
| 25-35 | 2.4.1 | WSN路由的特殊挑战 | 10分钟 |
| 35-40 | 2.4.1 | 路由协议分类体系 | 5分钟 |
| 40-50 | 2.4.2 | Flooding（泛洪协议） | 10分钟 |
| 50-58 | 2.4.2 | Gossiping（闲聊协议） | 8分钟 |
| 58-78 | 2.4.2 | SPIN（自适应信息传播）★★ | 20分钟 |
| 78-80 | 2.4.2 | 平面路由对比小结 | 2分钟 |
| 80-98 | 2.4.2 | DD（定向扩散协议）★ | 18分钟 |
| 98-100 | 2.4.2 | 平面路由协议小结 | 2分钟 |

### 第二次课（100分钟）

| 时间段 | 章节 | 内容 | 时长 |
|--------|------|------|------|
| 0-8 | 2.4.3 | 分簇思想引入 | 8分钟 |
| 8-43 | 2.4.3 | LEACH协议 ★★ | 35分钟 |
| 43-53 | 2.4.3 | HEED协议简介 | 10分钟 |
| 53-63 | 2.4.3 | PEGASIS协议简介 | 10分钟 |
| 63-70 | 2.4.3 | 层次路由协议小结 | 7分钟 |
| 70-82 | 2.4.4 | 地理位置路由简介 | 12分钟 |
| 82-92 | 2.4.4 | 协议综合对比 | 10分钟 |
| 92-97 | 2.4.4 | 知识框架总结 | 5分钟 |
| 97-100 | 2.4.4 | 衔接下一章 | 3分钟 |

---

## 重难点标注

### 重点内容（★★）
1. **SPIN三次握手机制**：ADV-REQ-DATA的协商过程
2. **LEACH两阶段工作过程**：建立阶段（簇头选举）+ 稳定阶段（数据传输与融合）
3. **WSN路由 vs 传统路由的区别**：以数据为中心、能量约束

### 次重点内容（★）
1. Flooding的三大问题（信息爆炸、数据重叠、资源盲目）
2. DD的三阶段（兴趣扩散、数据传播、路径加强）
3. 分簇思想的核心优势

### 难点内容
1. LEACH簇头选举的阈值公式T(n)的含义（不要求推导，理解含义即可）
2. DD中梯度的建立与路径加强机制
3. GPSR中空洞问题的处理

---

## 教学方法建议

1. **类比法**
   - Flooding → "大声喊" / Gossiping → "悄悄话" / SPIN → "先问再说"
   - LEACH → "班级分组制" / PEGASIS → "接力赛"
   - 分簇 → "公司组织架构（员工→部门经理→CEO）"

2. **对比法**
   - 贯穿始终的协议对比表格
   - 传统路由 vs WSN路由

3. **图示法**
   - 每个协议配合网络拓扑示意图
   - LEACH的分簇结构图
   - DD的三阶段示意图

4. **问题驱动**
   - 每引入新协议前，先提出上一个协议的不足
   - 引导学生思考"如何改进"

---

## 板书规划

### 第一次课板书
```
左侧：
2.4 网络层技术介绍
传统路由 vs WSN路由
| 传统 | WSN |
| 最短路径 | 最低能耗 |
| IP寻址 | 数据中心 |
| 资源丰富 | 资源受限 |

中间：
Flooding → Gossiping → SPIN → DD
（演进关系）

右侧：
SPIN三次握手：
A --ADV--> B
A <--REQ-- B
A --DATA-> B
```

### 第二次课板书
```
左侧：
LEACH两阶段：
建立阶段 | 稳定阶段
簇头选举 | TDMA传输
簇形成   | 数据融合
         | 簇头→BS

T(n) = p / (1 - p × (r mod 1/p))

中间：
分簇结构图

右侧：
协议总结：
平面：F, G, SPIN, DD
层次：LEACH, HEED, PEGASIS
地理：GEAR, GPSR
```
